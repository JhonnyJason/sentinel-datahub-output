(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{checkAccessMS:()=>N,checkSymbolsMS:()=>R,mrktStackSecret:()=>$,name:()=>B,persistentStateOptions:()=>L,trdvtCid:()=>C,trdvtPassword:()=>F,trdvtSecret:()=>z,trdvtUsername:()=>D,urlMrktStack:()=>J,urlTrdvt:()=>_,version:()=>I});var n={};t.r(n);var r={};t.r(r),t.d(r,{initialize:()=>V});var o={};t.r(o),t.d(o,{prepareAndExpose:()=>H});var s={};t.r(s),t.d(s,{initialize:()=>St,startSession:()=>Tt});var i={};t.r(i),t.d(i,{serviceStartup:()=>bt});const a=require("node:path");var u=t.n(a);const l=require("node:fs");var c,d,y=t.n(l);d=function(t){return JSON.stringify(t,null,4)},c={};var v=function(t){var e,n;return n=function(t){return e("\n"+d(t))},{log:e=function(e){c[t]&&console.log("["+t+"]: "+e)},olog:n}};const h=require("node:net");var p,f,m,E,g,k=t.n(h);({log:p,olog:f}=v("bugsnitch")),m=new Promise(function(t){return t}),g="unnamed",E=async function(t){var e;p("sendToBugsnitch"),await m,(e=k().createConnection("/run/bugsnitch.sk")).on("connect",function(){return e.end(t)}),e.on("error",function(t){return console.error(t)}),e.on("close",function(){return p("Connection closed!")})};var S,x,w,T,b=function(t){var e,n;if(p("report"),console.error(t),"string"!=typeof t)try{return n=`[${g}] Error: `+t.message,t.cause&&(n+="\n Cause: "+t.cause),t.stack&&(n+="\n Stack: "+t.stack),void E(n)}catch(t){e=t,console.error("bugsnitch.report: unexpected errorObject!\n "+e.message)}else E(n=`[${g}]: ${t}`)};x=Object.create(null);try{S=u().resolve(process.cwd(),"./.config.json"),w=y().readFileSync(S,"utf8"),x=JSON.parse(w)}catch(t){T="@configmodule - config parsing:\n",T+=" Local Config File could not be read or parsed!\n ",T+=t.message,b(T)}var j,O,A,M,P,q,z=x.secret||"none",C=x.cid||"none",D=x.name||"none",F=x.password||"none",$=x.mrktStackSecret||"none",_="https://live.tradovateapi.com/v1",J="https://api.marketstack.com/v2",N=6e5,R=36e5,B="Sentinel Datahub",I="v0.0.1",L={basePath:"../state",maxCacheSize:128};(function(t){var e;for(e in t)t[e]&&(c[e]=!0)})({bugsnitch:!0,marketstackmodule:!0,scimodule:!0,startupmodule:!0,tradovatemodule:!0}),({log:M,olog:P}=v("marketstackmodule")),j=null,O=null;var U,G,V=async function(t){M("initialize"),null!=t.mrktStackSecret&&(j=t.mrktStackSecret),null!=t.urlMrktStack&&(O=t.urlMrktStack),await q()};q=async function(){var t;M("runTest"),t=await A("ASML,MSTR"),M(Object.keys(t))},A=async function(t){var e,n,r,o,s;M("getEndOfDayData"),n=new URLSearchParams({access_key:j,symbols:t}),s=O+"/eod?"+n.toString();try{r=await fetch(s)}catch(t){e=t,console.error(e)}try{if(r.ok)return await r.json();console.error("status: "+r.status),o=await r.text(),console.error(o)}catch(t){e=t,console.error(e)}},({log:U,olog:G}=v("scimodule"));var H=function(){U("prepareAndExpose")};const K=require("path"),Q=require("fs");var W,X,Y,Z,tt,et,nt,rt,ot,st,it,at,ut,lt;X=Q.promises,Z=function(t){var e;return e=t+".json",K.resolve(null,e)},Y=function(t){return t+".backup"},W=function(t){var e,n;e=Y(t);try{Q.copyFileSync(t,e)}catch(e){throw n="Error: backing up state failed!\n",n+="file: "+t+"\n",n+="reason: "+e.message,new Error(n)}},ut=function(t){return JSON.stringify(t,null,4)},it={},at={},et=null,rt=null,st={},nt=0,tt=class{constructor(t){this.id=t,this.nextEntry=null,this.previousEntry=et,null==rt&&(rt=this),null!=et&&(et.nextEntry=this),et=this,st[this.id]=this,++nt>64&&ot()}touch(){null!=this.nextEntry&&(null!=this.previousEntry?(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry):(rt=this.nextEntry,this.nextEntry.previousEntry=null),this.nextEntry=null,this.previousEntry=et,null!=et&&(et.nextEntry=this),et=this)}remove(){return null!=this.nextEntry&&null!=this.previousEntry&&(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry),null==this.nextEntry&&null==this.previousEntry&&(et=null,rt=null),null!=this.nextEntry&&null==this.previousEntry&&(this.nextEntry.previousEntry=null,rt=this.nextEntry),null==this.nextEntry&&null!=this.previousEntry&&(this.previousEntry.nextEntry=null,et=this.previousEntry),lt(this.id)}toString(){var t;return t=this.id+"\n",null!=this.nextEntry?t+="  next: "+this.nextEntry.id+"\n":t+="  next: null\n",null!=this.previousEntry?t+="  previous: "+this.previousEntry.id+"\n":t+="  previous: null\n",t}},lt=function(t){delete at[t],delete it[t],delete st[t],nt--},ot=function(){var t;null!=(t=rt)&&(null!=(rt=t.nextEntry)&&(rt.previousEntry=null),lt(t.id))};var ct,dt,yt,vt,ht,pt,ft,mt,Et,gt,kt;({log:vt,olog:ht}=v("tradovatemodule")),kt=null,gt=null;var St=function(t){vt("initialize")};Et=function(t){vt("saveStorage"),t&&(gt=t),async function(t,e){var n;null!=st[t]?st[t].touch():new tt(t),e&&(at[t]=e),(n=ut(at[t]))!==it[t]&&(it[t]=n,await function(t,e){var n;n=Z(t),Q.writeFileSync(n,e),W(n)}(t,n))}("datahubState",gt)},yt=async function(t,e){var n,r,o,s;vt("getRequest"),r={method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},null!=e&&(r.headers.Authorization=`Bearer ${e}`);try{o=await fetch(t,r)}catch(t){n=t,console.error(n)}try{if(o.ok)return await o.json();console.error("status: "+o.status),s=await o.text(),console.error(s)}catch(t){n=t,console.error(n)}},pt=async function(t,e,n){var r,o,s,i;vt("postRequest"),o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},null!=n&&(o.headers.Authorization=`Bearer ${n}`);try{s=await fetch(t,o)}catch(t){r=t,console.error(r)}try{if(s.ok)return await s.json();console.error("status: "+s.status),i=await s.text(),console.error(i)}catch(t){r=t,console.error(r)}},ft=async function(){var t,e;vt("refreshToken"),e=kt+"/auth/renewAccessToken",t=await yt(e,gt.accessToken),ht(t),null!=t.accessToken&&(gt.accessToken=t.accessToken),null!=t.mdAccessToken&&(gt.mdAccessToken=t.mdAccessToken),null!=t.expirationTime&&(gt.expirationTime=t.expirationTime),Et()},mt=async function(){var t,e,n;vt("requestAccessToken"),e={name:null,password:null,appId:"sentinel",appVersion:null,cid:null,sec:null},n=kt+"/auth/accesstokenrequest",t=await pt(n,e),ht(t),null!=t&&Et(t)},dt=function(){var t,e,n,r;return vt("ensureFreshToken"),null==(e=gt.expirationTime)?mt():(t=new Date(e).getTime(),n=(new Date).getTime(),ht({exp:t,now:n,timeToExpiry:r=t-n}),r<0?mt():r<114e4?ft():void 0)},ct=async function(){var t,e;vt("checkSymbols"),vt("using url: "+(e=kt+"/product/list")),t=await yt(e,gt.mdAccessToken),ht(t)};var xt,wt,Tt=async function(t){vt("startSession"),t&&await mt(),await dt(),setInterval(dt,6e5),await ct(),setInterval(ct,36e5)};({log:xt,olog:wt}=v("startupmodule"));var bt=function(){xt("serviceStartup")};const jt={configmodule:e,debugmodule:n,marketstackmodule:r,scimodule:o,startupmodule:i,tradovatemodule:s};global.allModules=jt,async function(){var t,n,r;try{return r=function(){var r;for(n in r=[],jt)null!=(t=jt[n]).initialize&&r.push(t.initialize(e));return r}(),await Promise.all(r),await jt.startupmodule.serviceStartup()}catch(t){return b("@run: "+t.message)}}()})();