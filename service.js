/*! For license information please see service.js.LICENSE.txt */
(()=>{"use strict";var e={16(e){e.exports=require("url")},106(e){e.exports=require("zlib")},150(e,t,r){const n=r(434),i=r(692),o=r(611),s=r(278),a=r(756),{randomBytes:l,createHash:c}=r(982),{Duplex:u,Readable:f}=r(203),{URL:h}=r(16),d=r(485),p=r(356),g=r(468),{isBlob:y}=r(954),{BINARY_TYPES:m,CLOSE_TIMEOUT:v,EMPTY_BUFFER:_,GUID:b,kForOnEventAttribute:w,kListener:S,kStatusCode:E,kWebSocket:O,NOOP:k}=r(328),{EventTarget:{addEventListener:x,removeEventListener:T}}=r(243),{format:C,parse:A}=r(184),{toBuffer:N}=r(788),D=Symbol("kAborted"),$=[8,13],I=["CONNECTING","OPEN","CLOSING","CLOSED"],j=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class P extends n{constructor(e,t,r){super(),this._binaryType=m[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=P.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),L(this,e,t,r)):(this._autoPong=r.autoPong,this._closeTimeout=r.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){m.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const n=new p({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),i=new g(e,this._extensions,r.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[O]=this,i[O]=this,e[O]=this,n.on("conclude",z),n.on("drain",W),n.on("error",q),n.on("message",H),n.on("ping",V),n.on("pong",G),i.onerror=Z,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",X),e.on("data",Q),e.on("end",ee),e.on("error",te),this._readyState=P.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=P.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[d.extensionName]&&this._extensions[d.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING){const e="WebSocket was closed before the connection was established";return void M(this,this._req,e)}this.readyState!==P.CLOSING?(this._readyState=P.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),K(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==P.CONNECTING&&this.readyState!==P.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===P.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,r)):F(this,e,r)}pong(e,t,r){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===P.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,r)):F(this,e,r)}resume(){this.readyState!==P.CONNECTING&&this.readyState!==P.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==P.OPEN)return void F(this,e,r);const n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[d.extensionName]||(n.compress=!1),this._sender.send(e||_,n,r)}terminate(){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING){const e="WebSocket was closed before the connection was established";return void M(this,this._req,e)}this._socket&&(this._readyState=P.CLOSING,this._socket.destroy())}}}function L(e,t,r,n){const s={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:v,protocolVersion:$[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=s.autoPong,e._closeTimeout=s.closeTimeout,!$.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${$.join(", ")})`);let a;if(t instanceof h)a=t;else try{a=new h(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),e._url=a.href;const u="wss:"===a.protocol,f="ws+unix:"===a.protocol;let p;if("ws:"===a.protocol||u||f?f&&!a.pathname?p="The URL's pathname is empty":a.hash&&(p="The URL contains a fragment identifier"):p='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',p){const t=new SyntaxError(p);if(0===e._redirects)throw t;return void R(e,t)}const g=u?443:80,y=l(16).toString("base64"),m=u?i.request:o.request,_=new Set;let w,S;if(s.createConnection=s.createConnection||(u?B:U),s.defaultPort=s.defaultPort||g,s.port=a.port||g,s.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,s.headers={...s.headers,"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":y,Connection:"Upgrade",Upgrade:"websocket"},s.path=a.pathname+a.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(w=new d(!0!==s.perMessageDeflate?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=C({[d.extensionName]:w.offer()})),r.length){for(const e of r){if("string"!=typeof e||!j.test(e)||_.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");_.add(e)}s.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(a.username||a.password)&&(s.auth=`${a.username}:${a.password}`),f){const e=s.path.split(":");s.socketPath=e[0],s.path=e[1]}if(s.followRedirects){if(0===e._redirects){e._originalIpc=f,e._originalSecure=u,e._originalHostOrSocketPath=f?s.socketPath:a.host;const t=n&&n.headers;if(n={...n,headers:{}},t)for(const[e,r]of Object.entries(t))n.headers[e.toLowerCase()]=r}else if(0===e.listenerCount("redirect")){const t=f?!!e._originalIpc&&s.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&a.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!u)&&(delete s.headers.authorization,delete s.headers.cookie,t||delete s.headers.host,s.auth=void 0)}s.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(s.auth).toString("base64")),S=e._req=m(s),e._redirects&&e.emit("redirect",e.url,S)}else S=e._req=m(s);s.timeout&&S.on("timeout",()=>{M(e,S,"Opening handshake has timed out")}),S.on("error",t=>{null===S||S[D]||(S=e._req=null,R(e,t))}),S.on("response",i=>{const o=i.headers.location,a=i.statusCode;if(o&&s.followRedirects&&a>=300&&a<400){if(++e._redirects>s.maxRedirects)return void M(e,S,"Maximum redirects exceeded");let i;S.abort();try{i=new h(o,t)}catch(t){const r=new SyntaxError(`Invalid URL: ${o}`);return void R(e,r)}L(e,i,r,n)}else e.emit("unexpected-response",S,i)||M(e,S,`Unexpected server response: ${i.statusCode}`)}),S.on("upgrade",(t,r,n)=>{if(e.emit("upgrade",t),e.readyState!==P.CONNECTING)return;S=e._req=null;const i=t.headers.upgrade;if(void 0===i||"websocket"!==i.toLowerCase())return void M(e,r,"Invalid Upgrade header");const o=c("sha1").update(y+b).digest("base64");if(t.headers["sec-websocket-accept"]!==o)return void M(e,r,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"];let l;if(void 0!==a?_.size?_.has(a)||(l="Server sent an invalid subprotocol"):l="Server sent a subprotocol but none was requested":_.size&&(l="Server sent no subprotocol"),l)return void M(e,r,l);a&&(e._protocol=a);const u=t.headers["sec-websocket-extensions"];if(void 0!==u){if(!w)return void M(e,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");let t;try{t=A(u)}catch(t){return void M(e,r,"Invalid Sec-WebSocket-Extensions header")}const n=Object.keys(t);if(1!==n.length||n[0]!==d.extensionName)return void M(e,r,"Server indicated an extension that was not requested");try{w.accept(t[d.extensionName])}catch(t){return void M(e,r,"Invalid Sec-WebSocket-Extensions header")}e._extensions[d.extensionName]=w}e.setSocket(r,n,{allowSynchronousEvents:s.allowSynchronousEvents,generateMask:s.generateMask,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})}),s.finishRequest?s.finishRequest(S,e):S.end()}function R(e,t){e._readyState=P.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,s.connect(e)}function B(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=s.isIP(e.host)?"":e.host),a.connect(e)}function M(e,t,r){e._readyState=P.CLOSING;const n=new Error(r);Error.captureStackTrace(n,M),t.setHeader?(t[D]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(R,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function F(e,t,r){if(t){const r=y(t)?t.size:N(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${I[e.readyState]})`);process.nextTick(r,t)}}function z(e,t){const r=this[O];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[O]&&(r._socket.removeListener("data",Q),process.nextTick(Y,r._socket),1005===e?r.close():r.close(e,t))}function W(){const e=this[O];e.isPaused||e._socket.resume()}function q(e){const t=this[O];void 0!==t._socket[O]&&(t._socket.removeListener("data",Q),process.nextTick(Y,t._socket),t.close(e[E])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function J(){this[O].emitClose()}function H(e,t){this[O].emit("message",e,t)}function V(e){const t=this[O];t._autoPong&&t.pong(e,!this._isServer,k),t.emit("ping",e)}function G(e){this[O].emit("pong",e)}function Y(e){e.resume()}function Z(e){const t=this[O];t.readyState!==P.CLOSED&&(t.readyState===P.OPEN&&(t._readyState=P.CLOSING,K(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function K(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function X(){const e=this[O];if(this.removeListener("close",X),this.removeListener("data",Q),this.removeListener("end",ee),e._readyState=P.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){const t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[O]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",J),e._receiver.on("finish",J))}function Q(e){this[O]._receiver.write(e)||this.pause()}function ee(){const e=this[O];e._readyState=P.CLOSING,e._receiver.end(),this.end()}function te(){const e=this[O];this.removeListener("error",te),this.on("error",k),e&&(e._readyState=P.CLOSING,this.destroy())}Object.defineProperty(P,"CONNECTING",{enumerable:!0,value:I.indexOf("CONNECTING")}),Object.defineProperty(P.prototype,"CONNECTING",{enumerable:!0,value:I.indexOf("CONNECTING")}),Object.defineProperty(P,"OPEN",{enumerable:!0,value:I.indexOf("OPEN")}),Object.defineProperty(P.prototype,"OPEN",{enumerable:!0,value:I.indexOf("OPEN")}),Object.defineProperty(P,"CLOSING",{enumerable:!0,value:I.indexOf("CLOSING")}),Object.defineProperty(P.prototype,"CLOSING",{enumerable:!0,value:I.indexOf("CLOSING")}),Object.defineProperty(P,"CLOSED",{enumerable:!0,value:I.indexOf("CLOSED")}),Object.defineProperty(P.prototype,"CLOSED",{enumerable:!0,value:I.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(P.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(P.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[w])return t[S];return null},set(t){for(const t of this.listeners(e))if(t[w]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[w]:!0})}})}),P.prototype.addEventListener=x,P.prototype.removeEventListener=T,e.exports=P},181(e){e.exports=require("buffer")},184(e,t,r){const{tokenChars:n}=r(954);function i(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}e.exports={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t=Object.create(null);let r,o,s=Object.create(null),a=!1,l=!1,c=!1,u=-1,f=-1,h=-1,d=0;for(;d<e.length;d++)if(f=e.charCodeAt(d),void 0===r)if(-1===h&&1===n[f])-1===u&&(u=d);else if(0===d||32!==f&&9!==f){if(59!==f&&44!==f)throw new SyntaxError(`Unexpected character at index ${d}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${d}`);-1===h&&(h=d);const n=e.slice(u,h);44===f?(i(t,n,s),s=Object.create(null)):r=n,u=h=-1}}else-1===h&&-1!==u&&(h=d);else if(void 0===o)if(-1===h&&1===n[f])-1===u&&(u=d);else if(32===f||9===f)-1===h&&-1!==u&&(h=d);else if(59===f||44===f){if(-1===u)throw new SyntaxError(`Unexpected character at index ${d}`);-1===h&&(h=d),i(s,e.slice(u,h),!0),44===f&&(i(t,r,s),s=Object.create(null),r=void 0),u=h=-1}else{if(61!==f||-1===u||-1!==h)throw new SyntaxError(`Unexpected character at index ${d}`);o=e.slice(u,d),u=h=-1}else if(l){if(1!==n[f])throw new SyntaxError(`Unexpected character at index ${d}`);-1===u?u=d:a||(a=!0),l=!1}else if(c)if(1===n[f])-1===u&&(u=d);else if(34===f&&-1!==u)c=!1,h=d;else{if(92!==f)throw new SyntaxError(`Unexpected character at index ${d}`);l=!0}else if(34===f&&61===e.charCodeAt(d-1))c=!0;else if(-1===h&&1===n[f])-1===u&&(u=d);else if(-1===u||32!==f&&9!==f){if(59!==f&&44!==f)throw new SyntaxError(`Unexpected character at index ${d}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${d}`);-1===h&&(h=d);let n=e.slice(u,h);a&&(n=n.replace(/\\/g,""),a=!1),i(s,o,n),44===f&&(i(t,r,s),s=Object.create(null),r=void 0),o=void 0,u=h=-1}}else-1===h&&(h=d);if(-1===u||c||32===f||9===f)throw new SyntaxError("Unexpected end of input");-1===h&&(h=d);const p=e.slice(u,h);return void 0===r?i(t,p,s):(void 0===o?i(s,p,!0):i(s,o,a?p.replace(/\\/g,""):p),i(t,r,s)),t}}},203(e){e.exports=require("stream")},243(e,t,r){const{kForOnEventAttribute:n,kListener:i}=r(328),o=Symbol("kCode"),s=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),c=Symbol("kReason"),u=Symbol("kTarget"),f=Symbol("kType"),h=Symbol("kWasClean");class d{constructor(e){this[u]=null,this[f]=e}get target(){return this[u]}get type(){return this[f]}}Object.defineProperty(d.prototype,"target",{enumerable:!0}),Object.defineProperty(d.prototype,"type",{enumerable:!0});class p extends d{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[c]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[c]}get wasClean(){return this[h]}}Object.defineProperty(p.prototype,"code",{enumerable:!0}),Object.defineProperty(p.prototype,"reason",{enumerable:!0}),Object.defineProperty(p.prototype,"wasClean",{enumerable:!0});class g extends d{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(g.prototype,"error",{enumerable:!0}),Object.defineProperty(g.prototype,"message",{enumerable:!0});class y extends d{constructor(e,t={}){super(e),this[s]=void 0===t.data?null:t.data}get data(){return this[s]}}Object.defineProperty(y.prototype,"data",{enumerable:!0});const m={addEventListener(e,t,r={}){for(const o of this.listeners(e))if(!r[n]&&o[i]===t&&!o[n])return;let o;if("message"===e)o=function(e,r){const n=new y("message",{data:r?e:e.toString()});n[u]=this,v(t,this,n)};else if("close"===e)o=function(e,r){const n=new p("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[u]=this,v(t,this,n)};else if("error"===e)o=function(e){const r=new g("error",{error:e,message:e.message});r[u]=this,v(t,this,r)};else{if("open"!==e)return;o=function(){const e=new d("open");e[u]=this,v(t,this,e)}}o[n]=!!r[n],o[i]=t,r.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(const r of this.listeners(e))if(r[i]===t&&!r[n]){this.removeListener(e,r);break}}};function v(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}e.exports={CloseEvent:p,ErrorEvent:g,Event:d,EventTarget:m,MessageEvent:y}},261(e,t,r){r(150);const{Duplex:n}=r(203);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let r=!0;const a=new n({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,r){const n=!r&&a._readableState.objectMode?t.toString():t;a.push(n)||e.pause()}),e.once("error",function(e){a.destroyed||(r=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,n){if(e.readyState===e.CLOSED)return n(t),void process.nextTick(i,a);let o=!1;e.once("error",function(e){o=!0,n(e)}),e.once("close",function(){o||n(t),process.nextTick(i,a)}),r&&e.terminate()},a._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close())):e.once("open",function(){a._final(t)})},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,r,n){e.readyState!==e.CONNECTING?e.send(t,n):e.once("open",function(){a._write(t,r,n)})},a.on("end",o),a.on("error",s),a}},278(e){e.exports=require("net")},291(e,t,r){const{tokenChars:n}=r(954);e.exports={parse:function(e){const t=new Set;let r=-1,i=-1,o=0;for(;o<e.length;o++){const s=e.charCodeAt(o);if(-1===i&&1===n[s])-1===r&&(r=o);else if(0===o||32!==s&&9!==s){if(44!==s)throw new SyntaxError(`Unexpected character at index ${o}`);{if(-1===r)throw new SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);const n=e.slice(r,i);if(t.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);t.add(n),r=i=-1}}else-1===i&&-1!==r&&(i=o)}if(-1===r||-1!==i)throw new SyntaxError("Unexpected end of input");const s=e.slice(r,o);if(t.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}}},328(e){const t=["nodebuffer","arraybuffer","fragments"],r="undefined"!=typeof Blob;r&&t.push("blob"),e.exports={BINARY_TYPES:t,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:r,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},356(e,t,r){const{Writable:n}=r(203),i=r(485),{BINARY_TYPES:o,EMPTY_BUFFER:s,kStatusCode:a,kWebSocket:l}=r(328),{concat:c,toArrayBuffer:u,unmask:f}=r(788),{isValidStatusCode:h,isValidUTF8:d}=r(954),p=Buffer[Symbol.species];e.exports=class extends n{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new p(t.buffer,t.byteOffset+e,t.length-e),new p(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new p(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const t=this.consume(2);if(48&t[0])return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));const r=!(64&~t[0]);if(!r||this._extensions[i.extensionName]){if(this._fin=!(128&~t[0]),this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(r)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=r}else{if(!(this._opcode>7&&this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(r)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~t[1]),this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}else e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),r=t.readUInt32BE(0);r>Math.pow(2,21)-1?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&f(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void t(e)}this._fragments.push(r)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?c(r,t):"arraybuffer"===this._binaryType?u(c(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{const n=c(r,t);if(!this._skipUTF8Validation&&!d(n)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,s),this.end();else{const r=e.readUInt16BE(0);if(!h(r)){const e=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const n=new p(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!d(n)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=0}}createError(e,t,r,n,i){this._loop=!1,this._errored=!0;const o=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=n,o}}},434(e){e.exports=require("events")},468(e,t,r){const{Duplex:n}=r(203),{randomFillSync:i}=r(982),o=r(485),{EMPTY_BUFFER:s,kWebSocket:a,NOOP:l}=r(328),{isBlob:c,isValidStatusCode:u}=r(954),{mask:f,toBuffer:h}=r(788),d=Symbol("kByteLength"),p=Buffer.alloc(4),g=8192;let y,m=g;class v{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=l,this[a]=void 0}static frame(e,t){let r,n,o=!1,s=2,a=!1;t.mask&&(r=t.maskBuffer||p,t.generateMask?t.generateMask(r):(m===g&&(void 0===y&&(y=Buffer.alloc(g)),i(y,0,g),m=0),r[0]=y[m++],r[1]=y[m++],r[2]=y[m++],r[3]=y[m++]),a=0===(r[0]|r[1]|r[2]|r[3]),s=6),"string"==typeof e?n=t.mask&&!a||void 0===t[d]?(e=Buffer.from(e)).length:t[d]:(n=e.length,o=t.mask&&t.readOnly&&!a);let l=n;n>=65536?(s+=8,l=127):n>125&&(s+=2,l=126);const c=Buffer.allocUnsafe(o?n+s:s);return c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=l,126===l?c.writeUInt16BE(n,2):127===l&&(c[2]=c[3]=0,c.writeUIntBE(n,4,6)),t.mask?(c[1]|=128,c[s-4]=r[0],c[s-3]=r[1],c[s-2]=r[2],c[s-1]=r[3],a?[c,e]:o?(f(e,r,c,s,n),[c]):(f(e,r,e,0,n),[c,e])):[c,e]}close(e,t,r,n){let i;if(void 0===e)i=s;else{if("number"!=typeof e||!u(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const r=Buffer.byteLength(t);if(r>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+r),i.writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0)}const o={[d]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(v.frame(i,o),n)}ping(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):c(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[d]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(v.frame(e,o),r)}pong(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):c(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[d]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(v.frame(e,o),r)}send(e,t,r){const n=this._extensions[o.extensionName];let i,s,a=t.binary?2:1,l=t.compress;"string"==typeof e?(i=Buffer.byteLength(e),s=!1):c(e)?(i=e.size,s=!1):(i=(e=h(e)).length,s=h.readOnly),this._firstFragment?(this._firstFragment=!1,l&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=i>=n._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);const u={[d]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:s,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,r]):this.getBlobData(e,this._compress,u,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}getBlobData(e,t,r,n){this._bufferedBytes+=r[d],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(_,this,e,n)}this._bufferedBytes-=r[d];const i=h(e);t?this.dispatch(i,t,r,n):(this._state=0,this.sendFrame(v.frame(i,r),n),this.dequeue())}).catch(e=>{process.nextTick(b,this,e,n)})}dispatch(e,t,r,n){if(!t)return void this.sendFrame(v.frame(e,r),n);const i=this._extensions[o.extensionName];this._bufferedBytes+=r[d],this._state=1,i.compress(e,r.fin,(e,t)=>{this._socket.destroyed?_(this,new Error("The socket was closed while data was being compressed"),n):(this._bufferedBytes-=r[d],this._state=0,r.readOnly=!1,this.sendFrame(v.frame(t,r),n),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][d],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][d],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function _(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){const n=e._queue[r],i=n[n.length-1];"function"==typeof i&&i(t)}}function b(e,t,r){_(e,t,r),e.onerror(t)}e.exports=v},485(e,t,r){const n=r(106),i=r(788),o=r(605),{kStatusCode:s}=r(328),a=Buffer[Symbol.species],l=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),u=Symbol("total-length"),f=Symbol("callback"),h=Symbol("buffers"),d=Symbol("error");let p;function g(e){this[h].push(e),this[u]+=e.length}function y(e){this[u]+=e.length,this[c]._maxPayload<1||this[u]<=this[c]._maxPayload?this[h].push(e):(this[d]=new RangeError("Max payload size exceeded"),this[d].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[d][s]=1009,this.removeListener("data",y),this.reset())}function m(e){this[c]._inflate=null,this[d]?this[f](this[d]):(e[s]=1007,this[f](e))}e.exports=class{constructor(e,t,r){if(this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!p){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;p=new o(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[f];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==r)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}e[t]=r})}),e}decompress(e,t,r){p.add(n=>{this._decompress(e,t,(e,t)=>{n(),r(e,t)})})}compress(e,t,r){p.add(n=>{this._compress(e,t,(e,t)=>{n(),r(e,t)})})}_decompress(e,t,r){const o=this._isServer?"client":"server";if(!this._inflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=n.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[u]=0,this._inflate[h]=[],this._inflate.on("error",m),this._inflate.on("data",y)}this._inflate[f]=r,this._inflate.write(e),t&&this._inflate.write(l),this._inflate.flush(()=>{const e=this._inflate[d];if(e)return this._inflate.close(),this._inflate=null,void r(e);const n=i.concat(this._inflate[h],this._inflate[u]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[u]=0,this._inflate[h]=[],t&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),r(null,n)})}_compress(e,t,r){const o=this._isServer?"server":"client";if(!this._deflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=n.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[u]=0,this._deflate[h]=[],this._deflate.on("data",g)}this._deflate[f]=r,this._deflate.write(e),this._deflate.flush(n.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=i.concat(this._deflate[h],this._deflate[u]);t&&(e=new a(e.buffer,e.byteOffset,e.length-4)),this._deflate[f]=null,this._deflate[u]=0,this._deflate[h]=[],t&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),r(null,e)})}}},605(e){const t=Symbol("kDone"),r=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[r]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[r]()}[r](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},611(e){e.exports=require("http")},692(e){e.exports=require("https")},756(e){e.exports=require("tls")},788(e,t,r){const{EMPTY_BUFFER:n}=r(328),i=Buffer[Symbol.species];function o(e,t,r,n,i){for(let o=0;o<i;o++)r[n+o]=e[o]^t[3&o]}function s(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}if(e.exports={concat:function(e,t){if(0===e.length)return n;if(1===e.length)return e[0];const r=Buffer.allocUnsafe(t);let o=0;for(let t=0;t<e.length;t++){const n=e[t];r.set(n,o),o+=n.length}return o<t?new i(r.buffer,r.byteOffset,o):r},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let r;return t instanceof ArrayBuffer?r=new i(t):ArrayBuffer.isView(t)?r=new i(t.buffer,t.byteOffset,t.byteLength):(r=Buffer.from(t),e.readOnly=!1),r},unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{const t=r(Object(function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.mask=function(e,r,n,i,s){s<48?o(e,r,n,i,s):t.mask(e,r,n,i,s)},e.exports.unmask=function(e,r){e.length<32?s(e,r):t.unmask(e,r)}}catch(e){}},954(e,t,r){const{isUtf8:n}=r(181),{hasBlob:i}=r(328);function o(e){const t=e.length;let r=0;for(;r<t;)if(128&e[r])if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}else r++;return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},n)e.exports.isValidUTF8=function(e){return e.length<24?o(e):n(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const t=r(Object(function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.isValidUTF8=function(e){return e.length<32?o(e):t(e)}}catch(e){}},982(e){e.exports=require("crypto")},984(e,t,r){const n=r(434),i=r(611),{Duplex:o}=r(203),{createHash:s}=r(982),a=r(184),l=r(485),c=r(291),u=r(150),{CLOSE_TIMEOUT:f,GUID:h,kWebSocket:d}=r(328),p=/^[+/0-9A-Za-z]{22}==$/;function g(e){e._state=2,e.emit("close")}function y(){this.destroy()}function m(e,t,r,n){r=r||i.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(n).map(e=>`${e}: ${n[e]}`).join("\r\n")+"\r\n\r\n"+r)}function v(e,t,r,n,i,o){if(e.listenerCount("wsClientError")){const n=new Error(i);Error.captureStackTrace(n,v),e.emit("wsClientError",n,r,t)}else m(r,n,i,o)}e.exports=class extends n{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:f,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:u,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{const r=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const r of Object.keys(t))e.on(r,t[r]);return function(){for(const r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,n)=>{this.handleUpgrade(t,r,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(g,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",y);const i=e.headers["sec-websocket-key"],o=e.headers.upgrade,s=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void v(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void v(this,e,t,400,"Invalid Upgrade header");if(void 0===i||!p.test(i))return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==s&&8!==s)return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void m(t,400);const u=e.headers["sec-websocket-protocol"];let f=new Set;if(void 0!==u)try{f=c.parse(u)}catch(r){return void v(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const h=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&void 0!==h){const r=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=a.parse(h);e[l.extensionName]&&(r.accept(e[l.extensionName]),d[l.extensionName]=r)}catch(r){return void v(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const o={origin:e.headers[8===s?"sec-websocket-origin":"origin"],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,s,a,l)=>{if(!o)return m(t,s||401,a,l);this.completeUpgrade(d,i,f,e,t,r,n)});if(!this.options.verifyClient(o))return m(t,401)}this.completeUpgrade(d,i,f,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,c){if(!i.readable||!i.writable)return i.destroy();if(i[d])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return m(i,503);const u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${s("sha1").update(t+h).digest("base64")}`],f=new this.options.WebSocket(null,void 0,this.options);if(r.size){const e=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;e&&(u.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[l.extensionName]){const t=e[l.extensionName].params,r=a.format({[l.extensionName]:[t]});u.push(`Sec-WebSocket-Extensions: ${r}`),f._extensions=e}this.emit("headers",u,n),i.write(u.concat("\r\n").join("\r\n")),i.removeListener("error",y),f.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),c(f,n)}}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};r.r(n),r.d(n,{hasAccess:()=>T,initialize:()=>O,setAccess:()=>k,unsetAccess:()=>x});var i={};r.r(i),r.d(i,{blockIp:()=>gt,initialize:()=>dt,isBlocked:()=>pt});var o={};r.r(o),r.d(o,{initialize:()=>yt,signatureAuth:()=>mt});var s={};r.r(s),r.d(s,{accessManagerId:()=>Vt,checkAccessMS:()=>Ft,checkSymbolsMS:()=>zt,fallbackAuthCode:()=>Zt,legalOrigins:()=>Yt,liveDataHeartbeatMS:()=>qt,liveDataSymbols:()=>Wt,mrktStackSecret:()=>Ut,name:()=>Jt,persistentStateOptions:()=>Kt,snitchSocket:()=>Gt,trdvtCid:()=>Pt,trdvtPassword:()=>Rt,trdvtSecret:()=>jt,trdvtUsername:()=>Lt,urlMrktStack:()=>Mt,urlTrdvt:()=>Bt,version:()=>Ht});var a={};r.r(a),r.d(a,{daysBetween:()=>dr,generateDateRange:()=>pr,isPostTradingHour:()=>ar,isPreTradingHour:()=>sr,isTradingDay:()=>lr,isTradingHour:()=>or,isYesterday:()=>ur,lastTradingDay:()=>cr,nextDay:()=>fr,prevDay:()=>hr});var l={};r.r(l),r.d(l,{getClientSubscriptions:()=>Jr,getLatestPrice:()=>Vr,initialize:()=>gr,subscribeClientSocket:()=>zr,unsubscribeClientSocket:()=>qr,unsubscribeSymbol:()=>Wr,updatePrices:()=>Hr});var c={};r.r(c),r.d(c,{getStockAllHistory:()=>Kr,getStockNewerHistory:()=>Qr,getStockOlderHistory:()=>Xr,initialize:()=>Yr,startLiveDataHeartbeat:()=>Zr});var u={};r.r(u),r.d(u,{initialize:()=>jn,load:()=>Nn,remove:()=>Dn,save:()=>An});var f={};r.r(f),r.d(f,{initialize:()=>Kn});var h={};r.r(h),r.d(h,{forceLoadNewestStockData:()=>ei,getData:()=>ti,initialize:()=>Xn,recorrectData:()=>Qn});var d={};r.r(d);var p={};r.r(p),r.d(p,{onConnect:()=>Zi});var g={};r.r(g),r.d(g,{prepareAndExpose:()=>Qi});var y={};r.r(y),r.d(y,{serviceStartup:()=>fo});var m,v,_={};r.r(_),r.d(_,{initialize:()=>ho,startSession:()=>po}),v=function(e){return JSON.stringify(e,null,4)},m={};var b,w,S,E=function(e){var t,r;return r=function(e){return t("\n"+v(e))},{log:t=function(t){m[e]&&console.log("["+e+"]: "+t)},olog:r}};({log:w,olog:S}=E("accessmodule")),b=Object.create(null);var O=function(e){w("initialize"),e.fallbackAuthCode&&(b[e.fallbackAuthCode]={})},k=function({authCode:e,ttlMS:t}){var r,n;w("setAccess"),w(e),w(t),r=function(){return x(e)},null!=(n=b[e])?clearTimeout(n.deathTimerId):n={},n.deathTimerId=setTimeout(r,t),b[e]=n},x=function(e){var t;w("unsetAccess"),null!=(t=b[e])&&(clearTimeout(t.deathTimerId),delete b[e])},T=function(e){return null!=b[e]};const{p:C,n:A,Gx:N,Gy:D,a:$,d:I}={p:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,n:0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,h:8n,a:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,d:0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,Gx:0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy:0x6666666666666666666666666666666666666666666666666666666666666658n},j=(e="")=>{throw new Error(e)},P=e=>"string"==typeof e,L=(e,t)=>!(e=>e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name)(e)||"number"==typeof t&&t>0&&e.length!==t?j("Uint8Array expected"):e,R=e=>new Uint8Array(e),U=e=>Uint8Array.from(e),B=(e,t)=>e.toString(16).padStart(t,"0"),M=e=>Array.from(L(e)).map(e=>B(e,2)).join(""),F=e=>e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0,z=e=>{const t="hex invalid";if(!P(e))return j(t);const r=e.length,n=r/2;if(r%2)return j(t);const i=R(n);for(let r=0,o=0;r<n;r++,o+=2){const n=F(e.charCodeAt(o)),s=F(e.charCodeAt(o+1));if(void 0===n||void 0===s)return j(t);i[r]=16*n+s}return i},W=(e,t)=>L(P(e)?z(e):U(L(e)),t),q=()=>globalThis?.crypto,J=(...e)=>{const t=R(e.reduce((e,t)=>e+L(t).length,0));let r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t},H=BigInt,V=(e,t,r,n="bad number: out of range")=>(e=>"bigint"==typeof e)(e)&&t<=e&&e<r?e:j(n),G=(e,t=C)=>{const r=e%t;return r>=0n?r:t+r},Y=(e,t)=>{(0n===e||t<=0n)&&j("no inverse n="+e+" mod="+t);let r=G(e,t),n=t,i=0n,o=1n,s=1n,a=0n;for(;0n!==r;){const e=n/r,t=n%r,l=i-s*e,c=o-a*e;n=r,r=t,i=s,o=a,s=l,a=c}return 1n===n?G(i,t):j("no inverse")},Z=e=>e instanceof X?e:j("Point expected"),K=2n**256n;class X{static BASE;static ZERO;ex;ey;ez;et;constructor(e,t,r,n){const i=K;this.ex=V(e,0n,i),this.ey=V(t,0n,i),this.ez=V(r,1n,i),this.et=V(n,0n,i),Object.freeze(this)}static fromAffine(e){return new X(e.x,e.y,1n,G(e.x*e.y))}static fromBytes(e,t=!1){const r=I,n=U(L(e,32)),i=e[31];n[31]=-129&i;const o=re(n);V(o,0n,t?K:C);const s=G(o*o),a=G(s-1n),l=G(r*s+1n);let{isValid:c,value:u}=oe(a,l);c||j("bad point: y not sqrt");const f=1n==(1n&u),h=!!(128&i);return!t&&0n===u&&h&&j("bad point: x==0, isLastByteOdd"),h!==f&&(u=G(-u)),new X(u,o,1n,G(u*o))}assertValidity(){const e=$,t=I;if(this.is0())throw new Error("bad point: ZERO");const{ex:r,ey:n,ez:i,et:o}=this,s=G(r*r),a=G(n*n),l=G(i*i),c=G(l*l),u=G(s*e);if(G(l*G(u+a))!==G(c+G(t*G(s*a))))throw new Error("bad point: equation left != right (1)");if(G(r*n)!==G(i*o))throw new Error("bad point: equation left != right (2)");return this}equals(e){const{ex:t,ey:r,ez:n}=this,{ex:i,ey:o,ez:s}=Z(e),a=G(t*s),l=G(i*n),c=G(r*s),u=G(o*n);return a===l&&c===u}is0(){return this.equals(ee)}negate(){return new X(G(-this.ex),this.ey,this.ez,G(-this.et))}double(){const{ex:e,ey:t,ez:r}=this,n=$,i=G(e*e),o=G(t*t),s=G(2n*G(r*r)),a=G(n*i),l=e+t,c=G(G(l*l)-i-o),u=a+o,f=u-s,h=a-o,d=G(c*f),p=G(u*h),g=G(c*h),y=G(f*u);return new X(d,p,y,g)}add(e){const{ex:t,ey:r,ez:n,et:i}=this,{ex:o,ey:s,ez:a,et:l}=Z(e),c=$,u=I,f=G(t*o),h=G(r*s),d=G(i*u*l),p=G(n*a),g=G((t+r)*(o+s)-f-h),y=G(p-d),m=G(p+d),v=G(h-c*f),_=G(g*y),b=G(m*v),w=G(g*v),S=G(y*m);return new X(_,b,S,w)}multiply(e,t=!0){if(!t&&(0n===e||this.is0()))return ee;if(V(e,1n,A),1n===e)return this;if(this.equals(Q))return de(e).p;let r=ee,n=Q;for(let i=this;e>0n;i=i.double(),e>>=1n)1n&e?r=r.add(i):t&&(n=n.add(i));return r}toAffine(){const{ex:e,ey:t,ez:r}=this;if(this.equals(ee))return{x:0n,y:1n};const n=Y(r,C);return 1n!==G(r*n)&&j("invalid inverse"),{x:G(e*n),y:G(t*n)}}toBytes(){const{x:e,y:t}=this.assertValidity().toAffine(),r=te(t);return r[31]|=1n&e?128:0,r}toHex(){return M(this.toBytes())}clearCofactor(){return this.multiply(H(8n),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let e=this.multiply(A/2n,!1).double();return A%2n&&(e=e.add(this)),e.is0()}static fromHex(e,t){return X.fromBytes(W(e),t)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}toRawBytes(){return this.toBytes()}}const Q=new X(N,D,1n,G(N*D)),ee=new X(0n,1n,1n,0n);X.BASE=Q,X.ZERO=ee;const te=e=>z(B(V(e,0n,K),64)).reverse(),re=e=>H("0x"+M(U(L(e)).reverse())),ne=(e,t)=>{let r=e;for(;t-- >0n;)r*=r,r%=C;return r},ie=0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n,oe=(e,t)=>{const r=G(t*t*t),n=(e=>{const t=e*e%C*e%C,r=ne(t,2n)*t%C,n=ne(r,1n)*e%C,i=ne(n,5n)*n%C,o=ne(i,10n)*i%C,s=ne(o,20n)*o%C,a=ne(s,40n)*s%C,l=ne(a,80n)*a%C,c=ne(l,80n)*a%C,u=ne(c,10n)*i%C;return{pow_p_5_8:ne(u,2n)*e%C,b2:t}})(e*G(r*r*t)).pow_p_5_8;let i=G(e*r*n);const o=G(t*i*i),s=i,a=G(i*ie),l=o===e,c=o===G(-e),u=o===G(-e*ie);return l&&(i=s),(c||u)&&(i=a),1n==(1n&G(i))&&(i=G(-i)),{isValid:l||c,value:i}},se=e=>{return t=re(e),G(t,A);var t},ae=e=>((...e)=>ce.sha512Async(...e))(e.hashable).then(e.finish),le={zip215:!0},ce={sha512Async:async(...e)=>{const t=q()?.subtle??j("crypto.subtle must be defined"),r=J(...e);return R(await t.digest("SHA-512",r.buffer))},sha512Sync:void 0,bytesToHex:M,hexToBytes:z,concatBytes:J,mod:G,invert:Y,randomBytes:(e=32)=>q().getRandomValues(R(e))},ue=Math.ceil(32)+1;let fe;const he=(e,t)=>{const r=t.negate();return e?r:t},de=e=>{const t=fe||(fe=(()=>{const e=[];let t=Q,r=t;for(let n=0;n<ue;n++){r=t,e.push(r);for(let n=1;n<128;n++)r=r.add(t),e.push(r);t=r.double()}return e})());let r=ee,n=Q;const i=H(255),o=H(8);for(let s=0;s<ue;s++){let a=Number(e&i);e>>=o,a>128&&(a-=256,e+=1n);const l=128*s,c=l,u=l+Math.abs(a)-1,f=s%2!=0,h=a<0;0===a?n=n.add(he(f,t[c])):r=r.add(he(h,t[u]))}return{p:r,f:n}};var pe,ge,ye;new(require("string_decoder").StringDecoder)("utf-8"),new Array(256).fill(0).map(function(e,t){return BigInt(t)}),ye=Array.from("0123456789abcdef"),ge=new Array(256),ye.forEach(function(e){return ge[e]=16*parseInt(e,16)}),pe=new Array(256),ye.forEach(function(e){return pe[e]=parseInt(e,16)});var me,ve=function(e){var t,r,n,i;for(i=new Uint8Array(e.length/2),t=r=0,n=e.length;r<n;t=r+=2)i[t/2]=ge[e[t]]+pe[e[t+1]];return i};r(982),me=BigInt(2)**BigInt(252)+BigInt("27742317777372353535851937790883648493");var _e,be=async function(e,t,r){var n,i,o,s;return o=ve(e),i=ve(t),s=r,n=new Uint8Array(Buffer.from(s,"utf8")),await(async(e,t,r,n=le)=>ae(((e,t,r,n=le)=>{e=W(e,64),t=W(t),r=W(r,32);const{zip215:i}=n;let o,s,a,l,c=Uint8Array.of();try{o=X.fromHex(r,i),s=X.fromHex(e.slice(0,32),i),a=re(e.slice(32,64)),l=Q.multiply(a,!1),c=J(s.toBytes(),o.toBytes(),t)}catch(e){}return{hashable:c,finish:e=>{if(null==l)return!1;if(!i&&o.isSmallOrder())return!1;const t=se(e);return s.add(o.multiply(t,!1)).add(l.negate()).clearCofactor().is0()}}})(e,t,r,n)))(o,n,i)};_e=18e4;var we,Se,Ee,Oe,ke,xe,Te,Ce,Ae,Ne,De,$e,Ie,je,Pe,Le,Re,Ue;for(Re=null,Le=/^\d+$/,je=/(\.\.|--|-\.)|\.-/,$e=new Array(103),Ie=0;Ie<22;)$e["0123456789abcdefABCDEF".charCodeAt(Ie)]=!0,Ie++;for(Ce=new Array(123),Ie=0;Ie<64;)Ce["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.".charCodeAt(Ie)]=!0,Ie++;for(Te="\0\b\v\f\r",xe=new Array(160),Ie=0;Ie<61;)xe[Te.charCodeAt(Ie)]=!0,Ie++;Pe=function(e){var t,r,n,i;if(null!==e){for(t=0,i=(n=Object.keys(e)).length;t<i;t++){if("__proto__"===(r=n[t])||"constructor"===r||"prototype"===r)return!0;if("object"==typeof e[r]&&Pe(e[r]))return!0}return!1}},Oe=function(e){return function(t){if(t!==e)return et}},ke=function(e){return function(){throw new Error(e)}},Ae=function(e){var t;if(null==(t=Ue[e]))throw new Error(`Unrecognized Schematype! (${e})`);return t},Ne=function(e){var t,r,n,i;for(r=new Array(e.length),Ie=n=0,i=e.length;n<i;Ie=++n)switch(t=e[Ie],!1){case"number"!=typeof t:r[Ie]=Ae(t);break;case"string"!=typeof t:r[Ie]=Re(t);break;case"object"==typeof t:throw new Error(`Illegal ${typeof t}!`);case!Array.isArray(t):r[Ie]=Se(t);break;default:r[Ie]=Ee(t)}return r},De=function(e){var t,r,n,i,o,s;for(i=Object.keys(e),t=[],Ie=r=0,o=i.length;r<o;Ie=++r)if("number"!=typeof(s=e[n=i[Ie]]))if("string"!=typeof s){if("object"!=typeof s)throw new Error(`Illegal ${typeof s}!`);Array.isArray(s)?t.push([n,Se(s)]):t.push([n,Ee(s)])}else t.push([n,Re(s)]);else t.push([n,Ae(s)]);return t},Se=function(e){var t,r;if(0===e.length)throw new Error("[] is illegal!");return r=Ne(e),t=function(e){var t,n,i,o,s,a;if(!Array.isArray(e))return et;for(o=0,Ie=s=0,a=r.length;s<a;Ie=++s)if(i=r[Ie],void 0!==(t=e[Ie])&&o++,n=i(t))return n;return e.length>o?et:void 0},t},Ee=function(e){var t,r;if(null===e)throw new Error("null is illegal!");if(0===(r=De(e)).length)throw new Error("{} is illegal!");return t=function(e){var t,n,i,o,s,a;if("object"!=typeof e)return et;if(null===e)return et;for(i=0,o=0,s=r.length;o<s;o++)if(void 0!==(a=e[(t=r[o])[0]])&&i++,n=t[1](a))return n;return Object.keys(e).length>i?et:void 0},t},(Ue=new Array(47))[5]=function(e){if("string"!=typeof e)return Be},Ue[6]=function(e){var t,r,n,i,o,s,a;if("string"!=typeof e)return Be;if(e.length>320||e.length<5)return He;if(je.test(e))return Je;if((t=e.indexOf("@"))<=0||t>64||e.length-t<4||"."===e[0]||"."===e[t-1]||"-"===e[0]||"-"===e[t-1]||"."===e[t+1]||"-"===e[t+1])return Je;for(Ie=i=0,s=e.length;i<s;Ie=++i)if(r=e[Ie],!(Ce[e.charCodeAt(Ie)]||Ie===t||Ie<t&&("+"===r||"_"===r)))return Je;if("."===e[e.length-1]||"-"===e[e.length-1])return Je;if(o=t,(n=e.indexOf(".",t+1))<0)return Je;for(;n>0;){if(n-o>63)return Je;o=n,n=e.indexOf(".",o+1)}return a=e.slice(o+1),Le.test(a)?Je:void 0},Ue[7]=function(e){if("string"!=typeof e)return Be;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[8]=function(e){if("string"!=typeof e)return Be;if(32!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[9]=function(e){if("string"!=typeof e)return Be;if(64!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[10]=function(e){if("string"!=typeof e)return Be;if(128!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[11]=function(e){if("string"!=typeof e)return Be;if(256!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[12]=function(e){if("string"!=typeof e)return Be;if(512!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[2]=function(e){return"number"!=typeof e?Me:isNaN(e)?Ve:Infinity===e||-Infinity===e?Qe:void 0},Ue[1]=function(e){if("boolean"!=typeof e)return Fe},Ue[3]=function(e){if(!Array.isArray(e))return ze},Ue[4]=function(e){if("object"!=typeof e)return We},Ue[21]=function(e){if(void 0!==e)return"string"!=typeof e?Be:void 0},Ue[22]=function(e){var t,r,n,i,o,s,a;if(void 0!==e){if("string"!=typeof e)return Be;if(e.length>320||e.length<5)return He;if(je.test(e))return Je;if((t=e.indexOf("@"))<=0||t>64||e.length-t<4||"."===e[0]||"."===e[t-1]||"-"===e[0]||"-"===e[t-1]||"."===e[t+1]||"-"===e[t+1])return Je;for(Ie=i=0,s=e.length;i<s;Ie=++i)if(r=e[Ie],!(Ce[e.charCodeAt(Ie)]||Ie===t||Ie<t&&("+"===r||"_"===r)))return Je;if("."===e[e.length-1]||"-"===e[e.length-1])return Je;if(o=t,(n=e.indexOf(".",t+1))<0)return Je;for(;n>0;){if(n-o>63)return Je;o=n,n=e.indexOf(".",o+1)}return a=e.slice(o+1),Le.test(a)?Je:void 0}},Ue[23]=function(e){if(void 0!==e){if("string"!=typeof e)return Be;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[24]=function(e){if(void 0!==e){if("string"!=typeof e)return Be;if(32!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[25]=function(e){if(void 0!==e){if("string"!=typeof e)return Be;if(64!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[26]=function(e){if(void 0!==e){if("string"!=typeof e)return Be;if(128!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[27]=function(e){if(void 0!==e){if("string"!=typeof e)return Be;if(256!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[28]=function(e){if(void 0!==e){if("string"!=typeof e)return Be;if(512!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[30]=function(e){if(void 0!==e)return"number"!=typeof e?Me:isNaN(e)?Ve:Infinity===e||-Infinity===e?Qe:void 0},Ue[31]=function(e){if(void 0!==e)return"boolean"!=typeof e?Fe:void 0},Ue[32]=function(e){if(void 0!==e)return Array.isArray(e)?void 0:ze},Ue[33]=function(e){if(void 0!==e)return"object"!=typeof e?We:void 0},Ue[35]=function(e){if(null!==e)return"string"!=typeof e?Be:void 0},Ue[36]=function(e){var t,r,n,i,o,s,a;if(null!==e){if("string"!=typeof e)return Be;if(e.length>320||e.length<5)return He;if(je.test(e))return Je;if((t=e.indexOf("@"))<=0||t>64||e.length-t<4||"."===e[0]||"."===e[t-1]||"-"===e[0]||"-"===e[t-1]||"."===e[t+1]||"-"===e[t+1])return Je;for(Ie=i=0,s=e.length;i<s;Ie=++i)if(r=e[Ie],!(Ce[e.charCodeAt(Ie)]||Ie===t||Ie<t&&("+"===r||"_"===r)))return Je;if("."===e[e.length-1]||"-"===e[e.length-1])return Je;if(o=t,(n=e.indexOf(".",t+1))<0)return Je;for(;n>0;){if(n-o>63)return Je;o=n,n=e.indexOf(".",o+1)}return a=e.slice(o+1),Le.test(a)?Je:void 0}},Ue[37]=function(e){if(null!==e){if("string"!=typeof e)return Be;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[38]=function(e){if(null!==e){if("string"!=typeof e)return Be;if(32!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[39]=function(e){if(null!==e){if("string"!=typeof e)return Be;if(64!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[40]=function(e){if(null!==e){if("string"!=typeof e)return Be;if(128!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[41]=function(e){if(null!==e){if("string"!=typeof e)return Be;if(256!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[42]=function(e){if(null!==e){if("string"!=typeof e)return Be;if(512!==e.length)return He;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}}},Ue[44]=function(e){if(null!==e)return"number"!=typeof e?Me:isNaN(e)?Ve:Infinity===e||-Infinity===e?Qe:void 0},Ue[45]=function(e){if(null!==e)return"boolean"!=typeof e?Fe:void 0},Ue[46]=function(e){if(null!==e)return Array.isArray(e)?void 0:ze},Ue[19]=function(e){return"object"!=typeof e?We:null===e?Ge:void 0},Ue[14]=function(e){return"string"!=typeof e?Be:0===e.length?Ye:void 0},Ue[17]=function(e){return Array.isArray(e)?0===e.length?Ze:void 0:ze},Ue[15]=function(e){if("string"!=typeof e)return Be;if(0===e.length)return Ye;for(Ie=0;Ie<e.length;){if(void 0===$e[e.charCodeAt(Ie)])return qe;Ie++}},Ue[16]=function(e){var t;if("string"!=typeof e)return Be;if(0===e.length)return Ye;for(Ie=0;Ie<e.length;){if((t=e.charCodeAt(Ie))>767||xe[t])return Ke;Ie++}},Ue[13]=function(e){var t;if("string"!=typeof e)return Be;for(Ie=0;Ie<e.length;){if((t=e.charCodeAt(Ie))>767||xe[t])return Ke;Ie++}},Ue[43]=function(e){var t;if(null!==e){if("string"!=typeof e)return Be;for(Ie=0;Ie<e.length;){if((t=e.charCodeAt(Ie))>767||xe[t])return Ke;Ie++}}},Ue[29]=function(e){var t;if(void 0!==e){if("string"!=typeof e)return Be;for(Ie=0;Ie<e.length;){if((t=e.charCodeAt(Ie))>767||xe[t])return Ke;Ie++}}},Ue[18]=function(e){return"object"!=typeof e?We:Pe(e)?Xe:void 0},Ue[20]=function(e){return"object"!=typeof e?We:null===e?Ge:Pe(e)?Xe:void 0},Ue[34]=function(e){if(void 0!==e)return"object"!=typeof e?We:Pe(e)?Xe:void 0};var Be=1e3,Me=1001,Fe=1002,ze=1003,We=1004,qe=1005,Je=1006,He=1007,Ve=1008,Ge=1009,Ye=1010,Ze=1011,Ke=1012,Xe=1013,Qe=1014,et=2222;(we=Object.create(null))[Be]="Not a String!",we[Me]="Not a Number!",we[Fe]="Not a Boolean!",we[ze]="Not an Array!",we[We]="Not an Object!",we[qe]="String is not valid hex!",we[Je]="String is not a valid email!",we[He]="String size mismatch!",we[Ve]="Number is NaN!",we[Ge]="Object is null!",we[Ye]="String is empty!",we[Ze]="Array is empty!",we[Ke]="String is dirty!",we[Xe]="Object is dirty!",we[Qe]="Number is not finite!",we[et]="Is invalid!";var tt,rt,nt,it,ot=function(e,t){var r;if(Re=!0===t?Oe:ke("Static string!"),"number"==(r=typeof e))return Ae(e);if("string"===r)return Re(e);if("object"!==r)throw new Error(`Illegal ${typeof e}!`);return Array.isArray(e)?Se(e):Ee(e)};({log:nt,olog:it}=E("earlyblockermodule")),rt=new Set,tt=new Set;var st,at,lt,ct,ut,ft,ht,dt=function(e){var t,r,n,i,o;for(nt("initialize"),r=0,n=(o=e.legalOrigins).length;r<n;r++)i=o[r],rt.add(i);t=new Array(...rt),nt(`legalOrigins: ${t}`)},pt=function(e,t){return nt("isBlocked"),tt.has(e)?(nt(`blocked request with IP: ${e}`),"IP blocked!"):rt.has(t)?void nt("passed!"):(nt(`blocked request with origin: ${t}`),tt.add(e),"Illegal Origin!")},gt=function(e){return tt.add(e)};({log:at,olog:ct}=E("authmodule")),st=null,ft=6e5,ht=ot({senderId:9,timestamp:2,nonce:2,signature:10}),lt=Object.create(null);var yt=function(e){at("initialize"),st=e.accessManagerId,setInterval(ut,ft)};ut=function(){var e,t;for(e in t=Date.now(),lt)lt[e]<t&&delete lt[e]};var mt=async function(e,t){var r,n,i,o,s;return at("signatureAuth"),ct(t),n=t.meta.ip,r=t.meta.host,pt(n,r)?"Client Blocked!":ht(t.auth)?"Invalid Auth Object!":t.auth.senderId!==st?"Unauthorized Sender!":function(e){var t,r;if(e!==(r=(t=Date.now())-t%_e)&&e!==(r-=_e))return e!==(r+=36e4)?"invalid":void 0}(t.auth.timestamp)?"Invalid Timestamp!":(i=t.auth.nonce,null!=lt[i]?"Nonce used already!":(lt[i]=Date.now()+ft,o=t.auth.signature,s=t.bodyString.replace(o,"\"'\\"),await be(o,st,s)?void at("We have a fully authorized Request!"):"Invalid Signature!"))};const vt=require("node:path");var _t=r.n(vt);const bt=require("node:fs");var wt=r.n(bt);const St=require("node:net");var Et,Ot,kt,xt,Tt,Ct=r.n(St);({log:Et,olog:Ot}=E("bugsnitch")),kt=new Promise(function(e){return e}),Tt="unnamed",xt=async function(e){var t;Et("sendToBugsnitch"),await kt,(t=Ct().createConnection("/run/bugsnitch.sk")).on("connect",function(){return t.end(e)}),t.on("error",function(e){return console.error(e)}),t.on("close",function(){return Et("Connection closed!")})};var At,Nt,Dt,$t,It=function(e){var t,r;if(Et("report"),console.error(e),"string"!=typeof e)try{return r=`[${Tt}] Error: `+e.message,e.cause&&(r+="\n Cause: "+e.cause),e.stack&&(r+="\n Stack: "+e.stack),void xt(r)}catch(e){t=e,console.error("bugsnitch.report: unexpected errorObject!\n "+t.message)}else xt(r=`[${Tt}]: ${e}`)};Nt=Object.create(null);try{At=_t().resolve(process.cwd(),"./.config.json"),Dt=wt().readFileSync(At,"utf8"),Nt=JSON.parse(Dt)}catch(e){$t="@configmodule - config parsing:\n",$t+=" Local Config File could not be read or parsed!\n ",$t+=e.message,It($t)}var jt=Nt.secret||"none",Pt=Nt.cid||"none",Lt=Nt.name||"none",Rt=Nt.password||"none",Ut=Nt.mrktStackSecret||"none",Bt="https://live.tradovateapi.com/v1",Mt="https://api.marketstack.com/v2",Ft=6e5,zt=36e5,Wt=["HYG","SPY"],qt=3e6,Jt="Sentinel Datahub",Ht="v0.2.0",Vt=Nt.accessManagerId||"",Gt=Nt.snitchSocket||"/run/bugsnitch.sk",Yt=["localhost","localhost:3333","sentinel-dashboard-dev.dotv.ee","sentinel-datahub.dotv.ee","sentinel.ewag-handelssysteme.de"],Zt="aaaaaaaabbbbbbbbccccccccdddddddd",Kt={basePath:"../state",maxCacheSize:128};Nt=null;var Xt,Qt,er,tr,rr,nr,ir,or=function(e=new Date){var t;return(t=(e.getUTCHours()+19)%24*60+e.getUTCMinutes())>=420&&t<960},sr=function(e=new Date){var t;return(t=(e.getUTCHours()+19)%24*60+e.getUTCMinutes())>360&&t<420},ar=function(e=new Date){return(e.getUTCHours()+19)%24*60+e.getUTCMinutes()>=1080},lr=function(e=new Date){var t;return 0!==(t=e.getUTCDay())&&6!==t},cr=function(e=new Date){var t;for(t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()));0===t.getUTCDay()||6===t.getUTCDay();)t.setUTCDate(t.getUTCDate()-1);return t.toISOString().substring(0,10)},ur=function(e){var t;return t=new Date,e===new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-1)).toISOString().substring(0,10)},fr=function(e){var t;return(t=new Date(e+"T00:00:00Z")).setUTCDate(t.getUTCDate()+1),t.toISOString().substring(0,10)},hr=function(e){var t;return(t=new Date(e+"T00:00:00Z")).setUTCDate(t.getUTCDate()-1),t.toISOString().substring(0,10)},dr=function(e,t){var r,n;return n=new Date(e+"T00:00:00Z"),r=new Date(t+"T00:00:00Z"),Math.floor((r-n)/864e5)},pr=function(e,t){var r,n,i;for(n=[],r=new Date(e+"T00:00:00Z"),i=new Date(t+"T00:00:00Z");r<=i;)n.push(r.toISOString().substring(0,10)),r.setUTCDate(r.getUTCDate()+1);return n};({log:er,olog:rr}=E("livefeedmodule")),Qt=Object.create(null),ir=Object.create(null),nr=new Map,Xt=new Set;var gr=function(e){var t,r,n,i;if(er("initialize"),null!=e.liveDataSymbols)for(t=0,r=(n=e.liveDataSymbols).length;t<r;t++)i=n[t],Xt.add(i)};tr=function(e){var t,r,n,i,o,s,a;for(er("notifySubscribers"),r=0,n=e.length;r<n;r++)if(a=e[r],o=Qt[a],null!=(t=ir[a]))for(s of(i=`liveDataUpdate ${a} ${o}`,t))try{s.send(i)}catch(e){er(`A certain socket could not be notified! ${e.message}`)}};var yr,mr,vr,_r,br,wr,Sr,Er,Or,kr,xr,Tr,Cr,Ar,Nr,Dr,$r,Ir,jr,Pr,Lr,Rr,Ur,Br,Mr,Fr,zr=function(e,t){var r,n;return er("subscribeClientSocket"),!!Xt.has(t)&&(null==(n=nr.get(e))&&(n=new Set,nr.set(e,n)),n.add(t),null==(r=ir[t])&&(r=new Set,ir[t]=r),r.add(e),!0)},Wr=function(e,t){var r,n;return er("unsubscribeSymbol"),!(null==(n=nr.get(e))||!n.has(t)||(n.delete(t),null!=(r=ir[t])&&r.delete(e),0===n.size&&nr.delete(e),0))},qr=function(e){var t,r;if(er("unsubscribeClientSocket"),null!=(r=nr.get(e))){for(t of r)ir[t].delete(e);nr.delete(e)}},Jr=function(e){var t;return null==(t=nr.get(e))?[]:Array.from(t)},Hr=function(e){var t,r,n;for(r in er("updatePrices"),n=Object.create(null),e)t=e[r],Qt[r]!==t&&(n[r]=!0),Qt[r]=t;rr(Qt),tr(Object.keys(n))},Vr=function(e){var t;return null!=(t=Qt[e])?t:null},Gr=[].indexOf;({log:Cr,olog:Nr}=E("marketstackmodule")),yr=null,mr=null,_t().resolve(".","symbols.json"),_t().resolve(".","currencies.json"),Tr=[],xr=3e5,vr=0,_r=null,$r=0,Ir=null;var Yr=function(e){Cr("initialize"),null!=e.mrktStackSecret&&(yr=e.mrktStackSecret),null!=e.urlMrktStack&&(mr=e.urlMrktStack),null!=e.liveDataSymbols&&Tr.push(...e.liveDataSymbols),null!=e.liveDataHeartbeatMS&&(xr=e.liveDataHeartbeatMS)};kr=async function(){var e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,g,y;if(Cr("realTimeHeartbeat"),r=new Date,lr(r))if(Cr("Today is a trading-day - let's see what's up..."),or(r)){if(Cr("isTradingHour: true"),Ur(r),null==yr||null==mr)return;if(0===Tr.length)return;try{if(e=Tr.map(function(e){return e.replace(/\./g,"-")}).join(","),l=new URLSearchParams({access_key:yr,symbols:e}),y=`${mr}/intraday/latest?${l.toString()}`,null!=(t=await Rr(y)).error)return void Cr(`liveData API error: ${t.error.code}: ${t.error.message}`);for(o=Object.create(null),u=null!=(c=t.data)?c:[],n=0,s=u.length;n<s;n++)null!=(d=u[n]).symbol&&(o[p=d.symbol.replace(/-/g,".")]=null!=(f=null!=(h=d.last)?h:d.lastPrice)?f:d.close);try{Hr(o)}catch(e){Cr(`error in liveFeed.updatePrices! ${e.message}`)}}catch(e){Cr(`liveData retrieval error: ${e.message}`)}}else if(sr(r))Cr("isPreTradingHour: true"),Ur(r);else if(ar(r)){if(Cr("isPostTradingHour: true"),g=r.toISOString().substring(0,10),Ir!==g&&(Ir=g,$r=0),$r>=6)return void Cr("Post-trade attempt limit reached (6) - skipping");for($r++,Cr(`Post-trade attempt ${$r}/6`),i=0,a=Tr.length;i<a;i++)p=Tr[i],ei(p,!0)}else Cr("It's not an interesting time - we do nothing here :-)")},Ur=function(e){var t,r,n,i;if(i=e.toISOString().substring(0,10),_r!==i&&(_r=i,vr=0),vr>=3)Cr("EOD top-up attempt limit reached (3) - skipping");else for(vr++,Cr(`EOD top-up attempt ${vr}/3`),t=0,r=Tr.length;t<r;t++)n=Tr[t],ei(n)};var Zr=function(){Cr("startLiveDataHeartbeat"),kr(),setInterval(kr,xr)},Kr=async function(e){var t,r,n;return Cr(`getStockAllHistory: ${e}`),null==(n=await br(e))?null:(null!=n.error&&(r=n.error,Er(r)?Cr(`Plan limit reached: ${r.code}`):Cr(`API error: ${r.code}: ${r.message}`)),0===n.data.length?(Cr("No data received"),null):(t=Ar(n.data,e),(t=Sr(t)).meta.historyComplete=null==n.error,Cr(`Returning ${t.data.length} data points, historyComplete: ${t.meta.historyComplete}`),t))},Xr=async function(e,t){var r,n,i,o;return Cr(`getStockOlderHistory: ${e} olderThan=${t}`),n=hr(t),null==(o=await br(e,{date_to:n}))?null:(null!=o.error&&(i=o.error,Er(i)?Cr(`Plan limit reached: ${i.code}`):Cr(`API error: ${i.code}: ${i.message}`)),0===o.data.length?(Cr("No older data available"),null):(r=Ar(o.data,e),(r=Sr(r)).meta.historyComplete=null==o.error,Cr(`Returning ${r.data.length} older data points`),r))},Qr=async function(e,t,r=1){var n,i,o,s;return Cr(`getStockNewerHistory: ${e} newerThan=${t} startFactor=${r}`),i=fr(t),null==(s=await br(e,{date_from:i}))?null:(null!=s.error&&(o=s.error,Er(o)?Cr(`Plan limit reached: ${o.code}`):Cr(`API error: ${o.code}: ${o.message}`)),0===s.data.length?(Cr("No newer data available"),null):(n=Ar(s.data,e,r),n=Sr(n),Cr(`Returning ${n.data.length} newer data points`),n))};br=async function(e,t={}){var r,n,i,o,s;Cr(`fetchAllEodPages: ${e}`),r=[],i=0;try{for(;;){if(null!=(n=(o=await wr(e,{offset:i,limit:1e3,...t})).error))return{error:n,data:r};if(r.push(...o.data),s=o.pagination,r.length>=s.total)return{data:r};i+=1e3}}catch(e){return Cr(n=e)}},wr=async function(e,{offset:t,limit:r,date_from:n,date_to:i}){var o,s,a,l,c;Cr(`fetchEodPage: ${e} offset=${t}`),o=e.replace(/\./g,"-"),l=new URLSearchParams({access_key:yr,symbols:o,sort:"ASC",limit:r.toString(),offset:t.toString()}),null!=n&&l.set("date_from",n),null!=i&&l.set("date_to",i),c=`${mr}/eod?${l.toString()}`;try{s=await Rr(c)}catch(e){return Cr(`Network/parse error: ${(a=e).message}`),{error:{code:"network_error",message:a.message}}}return null!=s.error?{error:s.error}:{data:s.data,pagination:s.pagination}},Ar=function(e,t,r=1){var n,i,o,s,a,l,c,u,f,h,d,p,g,y,m,v,_,b,w,S,E,O,k,x,T,C,A,N,D,$,I,j,P,L,R,U;if(Cr(`normalizeEodResponse: ${e.length} records, startFactor=${r}`),0===e.length)return null;for(g=[],U=[{f:m=r,applied:!0}],k=null,L=!1,_=w=0,S=e.length;w<S;_=++w)y=(A=e[_]).date.substring(0,10),null!=A.split_factor&&1!==A.split_factor&&null!=k&&(n=A.adj_close/k.adj_close,T=A.close/k.close,O=A.split_factor,C=Or(T,O),i=Or(n,O),b=C,L=L||!b,R=Math.abs(T*A.split_factor-n)<.01,b||R||Cr(`We were not within the range to detect preAdjusted data. Neither was the split-factor making this difference! (adjChangeLikelyAdj: ${i})`),null!=(x=U[U.length-1])&&(x.end=hr(y)),f=null!=(N=e[_-2])?N.close:void 0,s=null!=(D=e[_-2])?D.adj_close:void 0,k.close,o=k.adj_close,h=A.close,a=A.adj_close,d=null!=($=e[_+1])?$.close:void 0,l=null!=(I=e[_+1])?I.adj_close:void 0,p=null!=(j=e[_+2])?j.close:void 0,c=null!=(P=e[_+2])?P.adj_close:void 0,Nr({factor:m,split_factor:A.split_factor,rawChange:T,adjChange:n,absDelta:Math.abs(T-n),isPreAdjusted:b,shouldApply:L,closeRM2:f,adjCloseRM2:s,adjCloseRM1:o,closeRN:h,adjCloseRN:a,closeRP1:d,adjCloseRP1:l,closeRP2:p,adjCloseRP2:c}),m*=A.split_factor,U.push({f:m,applied:L})),L?(v=A.high*m,E=A.low*m,u=A.close*m):(v=A.high,E=A.low,u=A.close),g.push({date:y,high:v,low:E,close:u}),k=A;return{meta:{startDate:g[0].date,endDate:g[g.length-1].date,interval:"1d",splitFactors:U},data:g.map(function(e){return[e.high,e.low,e.close]}),_dates:g.map(function(e){return e.date})}},Sr=function(e){var t,r,n,i,o,s,a,l,c,u,f,h,d;if(Cr("gapFillDataSet"),null==e||0===e.data.length)return e;for(({meta:h,data:n,_dates:t}=e),o={},a=l=0,d=t.length;0<=d?l<d:l>d;a=0<=d?++l:--l)o[t[a]]=n[a];for(r=pr(h.startDate,h.endDate),s=[],u=n[0][2],c=0,f=r.length;c<f;c++)null!=o[i=r[c]]?(s.push(o[i]),u=o[i][2]):s.push([u,u,u]);return{meta:h,data:s}},Er=function(e){var t,r;return t=["function_access_restricted","https_access_restricted","usage_limit_reached"],r=e.code,Gr.call(t,r)>=0},Or=function(e,t){var r,n;return r=e*t,n=Math.abs(r-1),Math.abs(r-t)<n},Lr=[],Dr=new Map,Pr=!1,Fr=0,Mr=0,Rr=function(e){return new Promise(function(t,r){if(!Dr.has(e))return Dr.set(e,[{resolve:t,reject:r}]),Lr.push(e),Pr?void 0:jr();Dr.get(e).push({resolve:t,reject:r})})},jr=async function(){var e,t,r,n,i,o,s,a,l,c,u;if(!Pr&&0!==Lr.length){for(Pr=!0;Lr.length>0;){0===Mr&&(Fr=performance.now()),Mr++,c=Lr.shift(),u=Dr.get(c);try{if(!(a=await fetch(c)).ok)throw l=await a.text(),new Error(`HTTP ${a.status}: ${l.slice(0,200)}`);for(e=await a.json(),Dr.delete(c),r=0,i=u.length;r<i;r++)u[r].resolve(e)}catch(e){for(t=e,Dr.delete(c),n=0,o=u.length;n<o;n++)u[n].reject(t)}Mr>=5&&((s=1001-(performance.now()-Fr))>0&&await Br(s),Mr=0)}Pr=!1}},Br=function(e){return new Promise(function(t){return setTimeout(t,e)})};const en=require("path");var tn=r.n(en);const rn=require("fs");var nn,on,sn,an,ln,cn,un=r.n(rn);sn=un().promises,on=null;var fn,hn,dn,pn,gn,yn,mn,vn,_n,bn,wn,Sn,En,On,kn,xn=function(e){var t;null==e&&(e="./state"),t=tn().isAbsolute(e)?e:tn().resolve(process.cwd(),e),on=t,un().existsSync(on)||un().mkdirSync(on)};ln=function(e){var t;return t=e+".json",tn().resolve(on,t)},an=function(e){return e+".backup"},nn=function(e){var t,r;t=an(e);try{un().copyFileSync(e,t)}catch(t){throw r="Error: backing up state failed!\n",r+="file: "+e+"\n",r+="reason: "+t.message,new Error(r)}},cn=function(e){var t,r,n,i;i=ln(e),t=an(i);try{return r=un().readFileSync(t,"utf-8"),n=JSON.parse(r),sn.writeFile(i,r),{contentObj:n,contentJson:r}}catch(e){return{contentObj:n=null,contentJson:r=null}}},({log:wn,olog:On}=E("statecachemodule")),vn={},En={},hn=null,pn=null,mn={},dn=0,Sn=64,yn=null,fn=class{constructor(e){this.id=e,this.nextEntry=null,this.previousEntry=hn,null==pn&&(pn=this),null!=hn&&(hn.nextEntry=this),hn=this,mn[this.id]=this,++dn>Sn&&gn()}touch(){null!=this.nextEntry&&(null!=this.previousEntry?(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry):(pn=this.nextEntry,this.nextEntry.previousEntry=null),this.nextEntry=null,this.previousEntry=hn,null!=hn&&(hn.nextEntry=this),hn=this)}remove(){return null!=this.nextEntry&&null!=this.previousEntry&&(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry),null==this.nextEntry&&null==this.previousEntry&&(hn=null,pn=null),null!=this.nextEntry&&null==this.previousEntry&&(this.nextEntry.previousEntry=null,pn=this.nextEntry),null==this.nextEntry&&null!=this.previousEntry&&(this.previousEntry.nextEntry=null,hn=this.previousEntry),kn(this.id)}toString(){var e;return e=this.id+"\n",null!=this.nextEntry?e+="  next: "+this.nextEntry.id+"\n":e+="  next: null\n",null!=this.previousEntry?e+="  previous: "+this.previousEntry.id+"\n":e+="  previous: null\n",e}},_n=function(e){var t,r;new fn(e),({contentObj:r,contentJson:t}=function(e){var t,r;r=ln(e);try{return t=un().readFileSync(r,"utf-8"),{contentObj:JSON.parse(t),contentJson:t}}catch(t){return cn(e)}}(e)),null!=r?(vn[e]=t,En[e]=r):bn(e)},bn=function(e){null==yn||null==yn[e]?(vn[e]="{}",En[e]={}):(vn[e]=JSON.stringify(yn[e]),En[e]=JSON.parse(vn[e]))},kn=function(e){delete En[e],delete vn[e],delete mn[e],dn--},gn=function(){var e;null!=(e=pn)&&(null!=(pn=e.nextEntry)&&(pn.previousEntry=null),kn(e.id))};var Tn,Cn,An=async function(e,t){var r;null!=mn[e]?mn[e].touch():new fn(e),t&&(En[e]=t),(r=JSON.stringify(En[e]))!==vn[e]&&(vn[e]=r,await function(e,t){var r;r=ln(e),un().writeFileSync(r,t),nn(r)}(e,r))},Nn=function(e){return null==En[e]?_n(e):mn[e].touch(),En[e]},Dn=async function(e){var t;null!=(t=mn[e])&&(t.remove(),await async function(e){var t,r,n,i;i=ln(e),t=an(i),r=sn.unlink(i),n=sn.unlink(t);try{await Promise.all([r,n])}catch(e){return}}(e))};({log:Tn,olog:Cn}=E("storagemodule"));var $n,In,jn=function(e){var t;Tn("initialize"),(t=e.persistentStateOptions)?(yn=t.defaultState,null!=t.maxCacheSize&&(Sn=t.maxCacheSize),xn(t.basePath)):xn()};({log:$n,olog:In}=E("symbolsmodule"));var Pn,Ln,Rn,Un,Bn,Mn,Fn,zn,Wn,qn,Jn,Hn,Vn,Gn,Yn,Zn,Kn=function(){$n("initialize")};({log:Jn,olog:Vn}=E("datamodule")),Zn=function(e){return`did:${e.replace(".","-")}`},Rn=5;var Xn=function(e){Jn("initialize"),null!=e.freshnessThreshold&&(Rn=e.freshnessThreshold)};zn=function(e){return Jn("isCommodityName"),!1},Wn=function(e){return Jn("isForexPair"),!1},qn=function(e,t){var r,n,i;return null!=(null!=e&&null!=(i=e.meta)?i.endDate:void 0)&&(r=new Date(e.meta.endDate+"T00:00:00Z"),n=new Date,Math.floor((n-r)/864e5)<=t)},Bn=function(e){var t,r,n;return null!=(n=null!=(r=e.meta)?r.splitFactors:void 0)&&n.length>0?!1===(t=n[n.length-1]).applied?1:t.f:1},Hn=function(e,t){return null==e?t:null==t?e:[...e.slice(0,-1),...t]},Gn=function(e,t){var r,n,i,o;return n=[],r=fr(e.meta.endDate),(i=dr(r,t.meta.startDate))>0&&(Jn(`WARNING: gap detected between ${e.meta.endDate} and ${t.meta.startDate}`),o=e.data[e.data.length-1][2],n=Ln(i,o)),i<0&&(Jn("WARNING: gap was negative! This should NEVER happen!"),e.data=e.data.slice(0,i)),{meta:{startDate:e.meta.startDate,endDate:t.meta.endDate,interval:t.meta.interval,historyComplete:e.meta.historyComplete,splitFactors:Hn(e.meta.splitFactors,t.meta.splitFactors)},data:[...e.data,...n,...t.data]}},Pn=function(e,t){var r,n,i,o;return n=[],r=fr(e.meta.endDate),(i=dr(r,t.meta.startDate))>0&&(Jn(`WARNING: gap detected between ${e.meta.endDate} and ${t.meta.startDate}`),o=e.data[e.data.length-1][2],n=Ln(i,o)),i<0&&(Jn("WARNING: gap was negative! This should NEVER happen!"),t.data=t.data.slice(Math.abs(i))),{meta:{startDate:e.meta.startDate,endDate:t.meta.endDate,interval:e.meta.interval,historyComplete:e.meta.historyComplete,splitFactors:Hn(e.meta.splitFactors,t.meta.splitFactors)},data:[...e.data,...n,...t.data]}},Ln=function(e,t){return Array(e).fill([t,t,t])},Yn=function(e,t){var r,n,i;return null==t||null==(null!=e?e.data:void 0)?e:(n=new Date,(r=new Date(Date.UTC(n.getUTCFullYear()-t,n.getUTCMonth(),n.getUTCDate())))<=new Date(e.meta.startDate+"T00:00:00Z")||(i=dr(e.meta.startDate,r.toISOString().slice(0,10)))<=0?e:{meta:{startDate:r.toISOString().slice(0,10),endDate:e.meta.endDate,interval:e.meta.interval,historyComplete:!1,splitFactors:e.meta.splitFactors},data:e.data.slice(i)})},Fn=async function(e){var t,r,n,i,o,s;return Jn(`getStockData ${e}`),n=Zn(e),null==(r=Nn(n)).data?(null!=(r=await Kr(e))&&An(n,r),r):null==(null!=(s=r.meta)?s.splitFactors:void 0)?(Jn(`Legacy data detected for ${e}  recorrecting`),Qn(e)):(r.meta.historyComplete||null!=(o=await Xr(e,r.meta.startDate))&&(r=Gn(o,r),An(n,r)),qn(r,Rn)||(t=Bn(r),null!=(i=await Qr(e,r.meta.endDate,t))&&(r=Pn(r,i),An(n,r))),r)},Un=function(e){var t;return Jn("getCommodityData"),t=Zn(e),Nn(t)},Mn=function(e){return Jn("getForexPairData"),Zn(e),{}};var Qn=async function(e){var t,r;return Jn(`recorrectData ${e}`),r=Zn(e),null!=(t=await Kr(e))?(An(r,t),Jn(`recorrectData complete: ${t.data.length} points, splitFactors: ${JSON.stringify(t.meta.splitFactors)}`)):Jn("recorrectData failed: no data returned"),t},ei=async function(e,t=!1){var r,n,i,o,s,a,l,c;return o=Zn(e),null==(n=Nn(o)).data?(null!=(n=await Kr(e))&&An(o,n),n):null==(null!=(l=n.meta)?l.splitFactors:void 0)?(Jn(`Legacy data detected for ${e}  recorrecting`),void await Qn(e)):(a=new Date,t?i=cr(a):(c=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()-1)),i=cr(c)),n.meta.endDate<i&&(r=Bn(n),null!=(s=await Qr(e,n.meta.endDate,r))&&(n=Pn(n,s),An(o,n))),void(n.meta.endDate>=i?Jn(`Data is up to date (ends: ${n.meta.endDate}, expected: ${i})`):Jn(`Data still behind expected (ends: ${n.meta.endDate}, expected: ${i})`)))},ti=async function(e,t){var r;return Jn(`getData ${e}, yearsBack: ${t}`),r=zn()?Un(e):Wn()?Mn(e):await Fn(e),Yn(r,t)};!function(e){var t;for(t in e)e[t]&&(m[t]=!0)}({}),r(261),r(356),r(468),r(150);var ri=r(984);const ni=require("node:http");var ii,oi,si,ai,li,ci,ui,fi,hi,di,pi,gi,yi,mi,vi,_i,bi,wi,Si,Ei,Oi,ki,xi,Ti,Ci,Ai,Ni,Di,$i,Ii=r.n(ni);require("node:crypto"),({log:gi,olog:mi}=E("scicoremodule")),fi=0,pi="",Ni=null,Ai=Object.create(null),Ci=Object.create(null),ci=null,$i=function(){var e;null!=Ni&&(e=function(){console.log("Gracefully Terminated. Bye!"),process.exit(0)},setTimeout(function(){console.log("Something is taking too long. It is getting killed now ;-) Bye!"),process.exit(0)},2e3),Ni.close(e))},Di=function(e){var t,r,n;if(r=parseInt(process.env.LISTEN_FDS),n=parseInt(process.env.LISTEN_PID),process.pid===n&&r>0)return hi(e.backlog);if("true"===process.env.SOCKETMODE)throw new Error("No Socket for SOCKETMODE!");if((t=parseInt(process.env.PORT))>0&&(e.listenOn=t),"systemd"===e.listenOn)throw new Error("option systemd failed: no Socket!");return vi(e)},hi=function(e){var t,r,n;return gi("handleSocketActivation"),t=null,n=new Promise(function(e){return t=e}),pi="SystemD FD 3",r={fd:3},Ni=Ni.listen(r,e,t),n},vi=function(e){var t,r,n;return t=null,r=new Promise(function(e){return t=e}),n={backlog:e.backlog},"string"==typeof e.listenOn?(n.path=e.listenOn,pi=`unix: ${n.path}`):(n.port=e.listenOn,pi=`tcp: ${n.port}`),Ni=Ni.listen(n,t),r},li=function(e,t){console.warn("Attempt to upgrade!"),t.end("HTTP/1.1 403 Forbidden\r\n\r\n")},oi=function(e,t){console.warn(e.message),"ECONNRESET"!==e.code&&t.writable&&t.end("HTTP/1.1 400 Bad Request\r\n\r\n")},yi=function(e,t){var r,n,i,o,s,a,l,c,u,f,h,d,p;return gi("mainRequestHandler_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-\n"),gi(`req.url: ${e.url}`),gi(`req.method: ${e.method}`),gi(`req.headers[Content-Type]: ${e.headers["content-type"]}`),gi(`req.headers[Content-Length]: ${e.headers["content-length"]}`),gi(`req.headers[Transfer-Encoding]: ${e.headers["transfer-encoding"]}`),mi(e.headers),t.on("error",function(e){return console.error(e.message)}),e.on("error",function(e){return console.error(e.message)}),"GET"!==e.method&&"POST"!==e.method?Ei(t):(p=e.url,d=e.method[0],null==(f=Ci[`${d}${p}`])?Si(t):(i=f.bodySizeLimit||fi,o=parseInt(e.headers["content-length"])||0,s=e.headers["content-type"],mi({cLength:o,cType:s,isJson:h="application/json"===s,hasBody:u=o>0}),h&&!u||u&&0===i?bi(t):(a={meta:ui(e),bodyString:"",bodyObj:void 0,auth:void 0,args:void 0},Object.freeze(a.meta),u?o>i?Oi(t):(r=[],n=0,l=function(s){return gi("dataRead"),(n+=s.length)>i||n>o?(mi({bodyLength:n,bodySizeLimit:i,cLength:o}),Oi(t),e.destroy()):r.push(s)},e.on("data",l),c=function(){if(gi("dataStreamEnd"),n!==o)return mi({bodyLength:n,cLength:o}),Oi(t),e.destroy();if(a.bodyString=Buffer.concat(r,n).toString("utf8"),h)try{a.bodyObj=JSON.parse(a.bodyString)}catch(e){return bi(t)}_i(e,t,f,a)},void e.on("end",c)):h?bi(t):_i(e,t,f,a))))},ui=function(e){var t,r;return r=Object.create(null),"string"==typeof(t=e.headers["x-forwarded-for"])&&t.length>6?r.ip=t.split(",")[0]:r.ip=e.socket.remoteAddress,r.host=e.headers.host,r.userAgent=e.headers["user-agent"],r},_i=async function(e,t,r,n){var i,o;gi("processRequest"),void 0===n.bodyObj?(n.auth=n.bodyString,n.args=n.bodyString):null===n.bodyObj?(n.auth=null,n.args=null):(o=n.bodyObj.auth,i=n.bodyObj.args,void 0===o&&void 0===i?(n.auth=n.bodyObj,n.args=n.bodyObj):(n.auth=o,n.args=i));try{await r.handler(e,t,n)}catch(e){ki(t,e)}},ai=function(e){var t,r,n,i,o;if(gi("compileRoutes"),null==e||"object"!=typeof e)return[];n=Object.keys(e),o=[];try{for(t=0,i=n.length;t<i;t++)r=n[t],o.push(...si(r,e[r]))}catch(e){throw new Error("Error on Compiling Routes: "+e.message)}return o},si=function(e,t){var r,n,i,o,s,a,l,c,u,f,h;if(gi(`compile ${e}`),mi(t),"/"===e[0]&&(e=e.slice(1)),o=t.func,i=t.conf,"function"!=typeof o)throw new Error(`No func for '${e}'!`);if("object"!=typeof i||null==i)throw new Error(`No conf for '${e}'!`);return c=`P/${e}`,s=null,null==i.authOption&&null==i.argsSchema&&(null==i.bodySizeLimit&&(i.bodySizeLimit=0),e.length>3&&0===e.indexOf("get")&&(s="G/",s+=e.slice(3,4).toLowerCase(),s+=e.slice(4))),r=null!=i.authOption?"1":"0",n=null!=i.argsSchema?"1":"0",f=null!=i.resultSchema?"1":"0",u=null!=i.responseAuth?"1":"0",null===ci&&(n="0",f="0"),gi("handlerType: "+(a=`${r}${n}${f}${u}`)),l=di[a](e,o,i),mi({postRoute:c,getRoute:s}),h={handler:l,bodySizeLimit:i.bodySizeLimit},Object.freeze(h),null!=s?[[s,h],[c,h]]:[[c,h]]},bi=function(e){e.statusCode=400,e.setHeader("Content-Type","text/plain"),e.end('400 "Request Malformed!"\n'),null!=arguments[1]&&console.error(arguments[1])},wi=function(e){e.statusCode=401,e.setHeader("Content-Type","text/plain"),e.end('401 "Not Authorized!"\n'),null!=arguments[1]&&console.error(arguments[1])},Si=function(e){e.statusCode=404,e.setHeader("Content-Type","text/plain"),e.end('404 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},Ei=function(e){e.statusCode=405,e.setHeader("Content-Type","text/plain"),e.end('405 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},Oi=function(e){e.statusCode=413,e.setHeader("Content-Type","text/plain"),e.end('413 "Payload too large!"\n'),null!=arguments[1]&&console.error(arguments[1])},ki=function(e){e.statusCode=500,e.setHeader("Content-Type","text/plain"),e.end('500 "Execution Error!"\n'),null!=arguments[1]&&console.error(arguments[1])},xi=function(e,t){e.statusCode=422,e.setHeader("Content-Type","text/plain"),e.end(`422 ${t}\n`),null!=arguments[1]&&console.error(t)},Ti=function(e,t){e.setHeader("Content-Type","application/json"),"string"==typeof t&&t.length>0?(e.statusCode=200,e.end(t)):(e.statusCode=204,e.end())},di=Object.create(null),ii=function(e){if("object"!=typeof e||null==e.error)return"No Error Object!"},di["0000"]=function(e,t,r){return async function(r,n,i){var o,s;return""!==i.bodyString||""!==i.auth||""!==i.args||void 0!==i.bodyObj?bi(n,`Invalid Context for handler 0000 @${e}!`):(Object.freeze(i),(s=await t(void 0,i))?"string"==typeof s&&s.length>0?(o=JSON.stringify(s),xi(n,o)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(o=JSON.stringify(s[0]),xi(n,o)):ii(s)?ki(n,"Invalid result!"):(o='{"error":'+JSON.stringify(s.error)+"}",xi(n,o)):Ti(n,""))}},di[1e3]=function(e,t,r){var n,i;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${e}!`);return i=async function(e,r,i){var o,s,a;return(o=await n(e,i))?wi(r,`Authentication fail! (${o})`):(Object.freeze(i.auth),i.args=void 0,Object.freeze(i),(a=await t(void 0,i))?"string"==typeof a&&a.length>0?(s=JSON.stringify(a),xi(r,s)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(s=JSON.stringify(a[0]),xi(r,s)):(o=ii(a))?ki(r,"Invalid result!"):(s='{"error":'+JSON.stringify(a.error)+"}",xi(r,s)):Ti(r,""))},i},di["0100"]=function(e,t,r){var n,i;if("function"!=typeof(i=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);return n=async function(e,r,n){var o,s,a;return(o=i(n.args))?bi(r,`Validation fail! (${o})`):(Object.freeze(n),(a=await t(n.args,n))?"string"==typeof a&&a.length>0?(s=JSON.stringify(a),xi(r,s)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(s=JSON.stringify(a[0]),xi(r,s)):(o=ii(a))?ki(r,"Invalid result!"):(s='{"error":'+JSON.stringify(a.error)+"}",xi(r,s)):Ti(r,""))},n},di[1100]=function(e,t,r){var n,i,o;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(o=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);return i=async function(e,r,i){var s,a,l;return(s=await n(e,i))?wi(r,`Authentication fail! (${s})`):(Object.freeze(i.auth),(s=o(i.args))?bi(r,`Validation fail! (${s})`):(Object.freeze(i),(l=await t(i.args,i))?"string"==typeof l&&l.length>0?(a=JSON.stringify(l),xi(r,a)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(a=JSON.stringify(l[0]),xi(r,a)):(s=ii(l))?ki(r,"Invalid result!"):(a='{"error":'+JSON.stringify(l.error)+"}",xi(r,a)):Ti(r,"")))},i},di["0010"]=function(e,t,r){var n;if("function"!=typeof(n=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);return async function(r,i,o){var s,a;return""!==o.bodyString||""!==o.auth||""!==o.args||void 0!==o.bodyObj?bi(i,`Invalid Context for handler 0010 @${e}!`):(Object.freeze(o),a=await t(void 0,o),n(a)?"string"==typeof a&&a.length>0?(s=JSON.stringify(a),xi(i,s)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(s=JSON.stringify(a[0]),xi(i,s)):ii(a)?ki(i,"Invalid result!"):(s='{"error":'+JSON.stringify(a.error)+"}",xi(i,s)):Ti(i,JSON.stringify(a)))}},di[1010]=function(e,t,r){var n,i,o;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(o=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);return i=async function(e,r,i){var s,a,l;return(s=await n(e,i))?wi(r,`Authentication fail! (${s})`):(Object.freeze(i.auth),i.args=void 0,Object.freeze(i),l=await t(void 0,i),(s=o(l))?"string"==typeof l&&l.length>0?(a=JSON.stringify(l),xi(r,a)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(a=JSON.stringify(l[0]),xi(r,a)):(s=ii(l))?ki(r,"Invalid result!"):(a='{"error":'+JSON.stringify(l.error)+"}",xi(r,a)):Ti(r,JSON.stringify(l)))},i},di["0110"]=function(e,t,r){var n,i,o;if("function"!=typeof(i=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);if("function"!=typeof(o=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);return n=async function(e,r,n){var s,a,l;return(s=i(n.args))?bi(r,`Validation fail! (${s})`):(Object.freeze(n),l=await t(n.args,n),(s=o(l))?"string"==typeof l&&l.length>0?(a=JSON.stringify(l),xi(r,a)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(a=JSON.stringify(l[0]),xi(r,a)):(s=ii(l))?ki(r,"Invalid result!"):(a='{"error":'+JSON.stringify(l.error)+"}",xi(r,a)):Ti(r,JSON.stringify(l)))},n},di[1110]=function(e,t,r){var n,i,o,s;if("function"!=typeof(n=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(o=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);if("function"!=typeof(s=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);return i=async function(e,r,i){var a,l,c;return(a=await n(e,i))?wi(r,`Authentication fail! (${a})`):(Object.freeze(i.auth),(a=o(i.args))?bi(r,`Validation fail! (${a})`):(Object.freeze(i),c=await t(i.args,i),(a=s(c))?"string"==typeof c&&c.length>0?(l=JSON.stringify(c),xi(r,l)):Array.isArray(c)&&1===c.length&&"string"==typeof c[0]&&c[0].length>0?(l=JSON.stringify(c[0]),xi(r,l)):(a=ii(c))?ki(r,"Invalid result!"):(l='{"error":'+JSON.stringify(c.error)+"}",xi(r,l)):Ti(r,JSON.stringify(c))))},i},di["0001"]=function(e,t,r){var n;if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return async function(r,i,o){var s,a,l;return""!==o.bodyString||""!==o.auth||""!==o.args||void 0!==o.bodyObj?bi(i,`Invalid Context for handler 0001 @${e}!`):(Object.freeze(o),(a=await t(void 0,o))?"string"==typeof a&&a.length>0?(s='{"error":'+JSON.stringify(a)+"}",s=await n(s,o),xi(i,s)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(s='{"error":'+JSON.stringify(a[0])+"}",s=await n(s,o),xi(i,s)):ii(a)?ki(i,"Invalid result!"):(s='{"error":'+JSON.stringify(a.error)+"}",s=await n(s,o),xi(i,s)):(l=await n('{"result":""}',o),Ti(i,l)))}},di[1001]=function(e,t,r){var n,i,o;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return o=async function(e,r,o){var s,a,l,c;return(s=await i(e,o))?wi(r,`Authentication fail! (${s})`):(Object.freeze(o.auth),o.args=void 0,Object.freeze(o),(l=await t(void 0,o))?"string"==typeof l&&l.length>0?(a='{"error":'+JSON.stringify(l)+"}",a=await n(a,o),xi(r,a)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(a='{"error":'+JSON.stringify(l[0])+"}",a=await n(a,o),xi(r,a)):(s=ii(l))?ki(r,"Invalid result!"):(a='{"error":'+JSON.stringify(l.error)+"}",a=await n(a,o),xi(r,a)):(c=await n('{"result":""}',o),Ti(r,c)))},o},di["0101"]=function(e,t,r){var n,i,o;if("function"!=typeof(o=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return i=async function(e,r,i){var s,a,l,c;return(s=o(i.args))?bi(r,`Validation fail! (${s})`):(Object.freeze(i),(l=await t(i.args,i))?"string"==typeof l&&l.length>0?(a='{"error":'+JSON.stringify(l)+"}",a=await n(a,i),xi(r,a)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(a='{"error":'+JSON.stringify(l[0])+"}",a=await n(a,i),xi(r,a)):(s=ii(l))?ki(r,"Invalid result!"):(a='{"error":'+JSON.stringify(l.error)+"}",a=await n(a,i),xi(r,a)):(c=await n('{"result":""}',i),Ti(r,c)))},i},di[1101]=function(e,t,r){var n,i,o,s;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(s=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return o=async function(e,r,o){var a,l,c,u;return(a=await i(e,o))?wi(r,`Authentication fail! (${a})`):(Object.freeze(o.auth),(a=s(o.args))?bi(r,`Validation fail! (${a})`):(Object.freeze(o),(c=await t(o.args,o))?"string"==typeof c&&c.length>0?(l='{"error":'+JSON.stringify(c)+"}",l=await n(l,o),xi(r,l)):Array.isArray(c)&&1===c.length&&"string"==typeof c[0]&&c[0].length>0?(l='{"error":'+JSON.stringify(c[0])+"}",l=await n(l,o),xi(r,l)):(a=ii(c))?ki(r,"Invalid result!"):(l='{"error":'+JSON.stringify(c.error)+"}",l=await n(l,o),xi(r,l)):(u=await n('{"result":""}',o),Ti(r,u))))},o},di["0011"]=function(e,t,r){var n,i;if("function"!=typeof(i=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return async function(r,o,s){var a,l,c;return""!==s.bodyString||""!==s.auth||""!==s.args||void 0!==s.bodyObj?bi(o,`Invalid Context for handler 0011 @${e}!`):(Object.freeze(s),l=await t(void 0,s),i(l)?"string"==typeof l&&l.length>0?(a='{"error":'+JSON.stringify(l)+"}",a=await n(a,s),xi(o,a)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(a='{"error":'+JSON.stringify(l[0])+"}",a=await n(a,s),xi(o,a)):ii(l)?ki(o,"Invalid result!"):(a='{"error":'+JSON.stringify(l.error)+"}",a=await n(a,s),xi(o,a)):(c='{"result":'+JSON.stringify(l)+"}",c=await n(c,s),Ti(o,c)))}},di[1011]=function(e,t,r){var n,i,o,s;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(s=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return o=async function(e,r,o){var a,l,c,u;return(a=await i(e,o))?wi(r,`Authentication fail! (${a})`):(Object.freeze(o.auth),o.args=void 0,Object.freeze(o),c=await t(void 0,o),(a=s(c))?"string"==typeof c&&c.length>0?(l='{"error":'+JSON.stringify(c)+"}",l=await n(l,o),xi(r,l)):Array.isArray(c)&&1===c.length&&"string"==typeof c[0]&&c[0].length>0?(l='{"error":'+JSON.stringify(c[0])+"}",l=await n(l,o),xi(r,l)):(a=ii(c))?ki(r,"Invalid result!"):(l='{"error":'+JSON.stringify(c.error)+"}",l=await n(l,o),xi(r,l)):(u='{"result":'+JSON.stringify(c)+"}",u=await n(u,o),Ti(r,u)))},o},di["0111"]=function(e,t,r){var n,i,o,s;if("function"!=typeof(o=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);if("function"!=typeof(s=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return i=async function(e,r,i){var a,l,c,u;return(a=o(i.args))?bi(r,`Validation fail! (${a})`):(Object.freeze(i),c=await t(i.args,i),(a=s(c))?"string"==typeof c&&c.length>0?(l='{"error":'+JSON.stringify(c)+"}",l=await n(l,i),xi(r,l)):Array.isArray(c)&&1===c.length&&"string"==typeof c[0]&&c[0].length>0?(l='{"error":'+JSON.stringify(c[0])+"}",l=await n(l,i),xi(r,l)):(a=ii(c))?ki(r,"Invalid result!"):(l='{"error":'+JSON.stringify(c.error)+"}",l=await n(l,i),xi(r,l)):(u='{"result":'+JSON.stringify(c)+"}",u=await n(u,i),Ti(r,u)))},i},di[1111]=function(e,t,r){var n,i,o,s,a;if("function"!=typeof(i=r.authOption))throw new Error(`authOption not a function @${e}!`);if("function"!=typeof(s=ci(r.argsSchema,!0)))throw new Error(`validateArgs is not a function @${e}!`);if("function"!=typeof(a=ci(r.resultSchema,!0)))throw new Error(`validateResult is not a function @${e}!`);if("function"!=typeof(n=r.responseAuth))throw new Error(`addResponseAuth is not a function @${e}!`);return o=async function(e,r,o){var l,c,u,f;return(l=await i(e,o))?wi(r,`Authentication fail! (${l})`):(Object.freeze(o.auth),(l=s(o.args))?bi(r,`Validation fail! (${l})`):(Object.freeze(o),u=await t(o.args,o),(l=a(u))?"string"==typeof u&&u.length>0?(c='{"error":'+JSON.stringify(u)+"}",c=await n(c,o),xi(r,c)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(c='{"error":'+JSON.stringify(u[0])+"}",c=await n(c,o),xi(r,c)):(l=ii(u))?ki(r,"Invalid result!"):(c='{"error":'+JSON.stringify(u.error)+"}",c=await n(c,o),xi(r,c)):(f='{"result":'+JSON.stringify(u)+"}",f=await n(f,o),Ti(r,f))))},o};var ji,Pi,Li,Ri,Ui,Bi,Mi=function(e,t,r){if(null!==Ni)throw new Error("Server already running!");if("string"!=typeof e)throw new Error("Route not a string!");if("function"!=typeof t)throw new Error("Func not a function!");if(null!=Ai[e])throw new Error("Cannot add route twice!");if(null==t)throw new Error("function must be defined!");null!=r&&"object"==typeof r||(r=Object.create(null)),Ai[e]={func:t,conf:r}},Fi=function(e){if(null!==Ni)throw new Error("Server already running!");if("function"!=typeof e)throw new Error("Func not a function!");ci=e};({log:Ri,olog:Ui}=E("wsimodule")),Pi=0,ji=class{constructor(e,t){var r;this.onMessage=this.onMessage.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.noteUsage=this.noteUsage.bind(this),this.close=this.close.bind(this),this.socket=e,this.clientId=t,r=this,this.socket.onmessage=function(e){return r.onMessage(e)},this.socket.onclose=function(e){return r.onDisconnect(e)},Ri(`${this.clientId} connected!`)}onMessage(e){var t,r,n,i;Ri("onMessage"),t=performance.now();try{n=Bi(e.data,this.socket)}catch(e){It("Socket.onMessage: "+e.message)}r=performance.now()-t,(i=null!=n?n:{success:!1,error:"fatal",bytes:e.data.length}).processingTime=r,this.noteUsage(i)}onDisconnect(e){Ri(`onDisconnect: ${this.clientId}`);try{qr(this.socket)}catch(e){Ri(e)}}noteUsage(e){Ri(`noteUsage: ${this.clientId}`),Ui(e)}close(){Ri(`closeSocket for: ${this.clientId}`),this.socket.close()}},Li=function(e){var t,r,n,i;return Ri("disectMessage"),n=(i=e.split(" "))[0],r="",t="",i.length>=2&&(r=i[1]),3===i.length&&(t=i[2]),i.length>3&&(t=i.slice(2).join(" ")),{command:n,authCode:r,argument:t}},Bi=function(e,t){var r,n,i,o;if(Ri("processMessage"),Ui({message:e}),(i=Object.create(null)).success=!1,i.bytes=e.length,r=Li(e),Ui(r),i.error="Unauthorized!",!T(r.authCode))return i;switch(i.error=`unknown command: ${r.command}`,r.command){case"subscribe":if(!zr(t,r.argument))return t.send(`subscribe error ${r.argument}`),i;t.send(`subscribe success ${r.argument}`),n=Vr(r.argument),e=`liveDataUpdate ${r.argument} ${n}`,t.send(e);break;case"unsubscribe":if(!Wr(t,r.argument))return t.send(`unsubscribe error ${r.argument}`),i;t.send(`unsubscribe success ${r.argument}`);break;case"viewSubscriptions":o=Jr(t),t.send(`viewSubscriptions ${o.join(" ")}`);break;default:return i}return i.success=!0,i.error=null,i};var zi,Wi,qi,Ji,Hi,Vi,Gi,Yi,Zi=function(e,t){Ui({headers:t.headers,url:t.url}),new ji(e,`${Pi}`),Pi++};({log:zi,olog:Wi}=E("accesssci")),Fi(ot),Mi("grantAccess",k,{bodySizeLimit:1024,authOption:mt,argsSchema:{authCode:8,ttlMS:2}}),Mi("revokeAccess",x,{bodySizeLimit:1024,authOption:mt,argsSchema:8}),({log:qi,olog:Ji}=E("datasci")),Fi(ot),Mi("getEODHLCData",async function(e){return await ti(e.dataKey,e.yearsBack)},{bodySizeLimit:1024,authOption:function(e){return null!=e&&T(e.authCode)},argsSchema:{authCode:8,dataKey:14,yearsBack:30},resultSchema:{meta:{startDate:14,endDate:14,interval:"1d",splitFactors:3,historyComplete:1},data:3}}),({log:Hi,olog:Vi}=E("scimodule")),(Gi=new ri({noServer:!0})).on("connection",Zi),Yi=function(e,t,r){Gi.handleUpgrade(e,t,r,function(t){return Gi.emit("connection",t,e)})};var Ki,Xi,Qi=async function(){Hi("prepareAndExpose"),function(e){if(null!==Ni)throw new Error("Server already running!");if("function"!=typeof e)throw new Error("Func not a function!");li=e}(Yi),await async function(e){var t,r,n,i,o,s,a,l,c,u,f;for(gi("sciStartServer"),null!=e&&"object"==typeof e||(e=Object.create(null)),fi=e.bodySizeLimit||5e5,u=e.requestTimeout||5e4,r=e.headersTimeout||8e3,o=e.keepAliveTimeout||12e4,e.maxHeadersCount,l=e.maxHeaderSize||2048,i=0,s=(f=ai(Ai)).length;i<s;i++)c=f[i],Ci[c[0]]=c[1];Ai=null,n={headersTimeout:r,maxHeaderSize:l,requestTimeout:u,keepAliveTimeout:o},(Ni=Ii().createServer(n)).on("request",yi),Ni.on("upgrade",li),Ni.on("clientError",oi),"number"==typeof e.backlog&&(t=e.backlog),a={backlog:t,listenOn:e.listenOn||3333},await Di(a),mi({listeningMode:pi}),process.on("SIGTERM",$i),process.on("SIGINT",$i)}(),Hi("Server listening!")};({log:Ki,olog:Xi}=E("startupmodule"));var eo,to,ro,no,io,oo,so,ao,lo,co,uo,fo=async function(){Ki("serviceStartup"),Zr(),await Qi()};({log:no,olog:io}=E("tradovatemodule")),uo=null,co=null;var ho=function(e){no("initialize")};lo=function(e){no("saveStorage"),e&&(co=e),An("datahubState",co)},ro=async function(e,t){var r,n,i,o;no("getRequest"),n={method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},null!=t&&(n.headers.Authorization=`Bearer ${t}`);try{i=await fetch(e,n)}catch(e){r=e,console.error(r)}try{if(i.ok)return await i.json();console.error("status: "+i.status),o=await i.text(),console.error(o)}catch(e){r=e,console.error(r)}},oo=async function(e,t,r){var n,i,o,s;no("postRequest"),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},null!=r&&(i.headers.Authorization=`Bearer ${r}`);try{o=await fetch(e,i)}catch(e){n=e,console.error(n)}try{if(o.ok)return await o.json();console.error("status: "+o.status),s=await o.text(),console.error(s)}catch(e){n=e,console.error(n)}},so=async function(){var e,t;no("refreshToken"),t=uo+"/auth/renewAccessToken",e=await ro(t,co.accessToken),io(e),null!=e.accessToken&&(co.accessToken=e.accessToken),null!=e.mdAccessToken&&(co.mdAccessToken=e.mdAccessToken),null!=e.expirationTime&&(co.expirationTime=e.expirationTime),lo()},ao=async function(){var e,t,r;no("requestAccessToken"),t={name:null,password:null,appId:"sentinel",appVersion:null,cid:null,sec:null},r=uo+"/auth/accesstokenrequest",e=await oo(r,t),io(e),null!=e&&lo(e)},to=function(){var e,t,r,n;return no("ensureFreshToken"),null==(t=co.expirationTime)?ao():(e=new Date(t).getTime(),r=(new Date).getTime(),io({exp:e,now:r,timeToExpiry:n=e-r}),n<0?ao():n<114e4?so():void 0)},eo=async function(){var e,t;no("checkSymbols"),no("using url: "+(t=uo+"/product/list")),e=await ro(t,co.mdAccessToken),io(e)};var po=async function(e){no("startSession"),e&&await ao(),await to(),setInterval(to,6e5),await eo(),setInterval(eo,36e5)};const go={accessmodule:n,authmodule:o,configmodule:s,datamodule:h,dateutilsmodule:a,debugmodule:d,earlyblockermodule:i,livefeedmodule:l,marketstackmodule:c,scimodule:g,startupmodule:y,storagemodule:u,symbolsmodule:f,tradovatemodule:_,wsimodule:p};global.allModules=go,async function(){var e,t,r;try{return r=function(){var r;for(t in r=[],go)null!=(e=go[t]).initialize&&r.push(e.initialize(s));return r}(),await Promise.all(r),await go.startupmodule.serviceStartup()}catch(e){return It("@run: "+e.message)}}()})();