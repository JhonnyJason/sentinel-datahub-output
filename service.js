/*! For license information please see service.js.LICENSE.txt */
(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{hasAccess:()=>$,initialize:()=>O,setAccess:()=>A,unsetAccess:()=>E});var n={};t.r(n),t.d(n,{blockIp:()=>he,initialize:()=>ce,isBlocked:()=>de});var r={};t.r(r),t.d(r,{initialize:()=>ge,signatureAuth:()=>ye});var i={};t.r(i),t.d(i,{accessManagerId:()=>Fe,checkAccessMS:()=>Pe,checkSymbolsMS:()=>Me,fallbackAuthCode:()=>Ze,legalOrigins:()=>Ge,liveDataHeartbeatMS:()=>Be,liveDataSymbols:()=>He,mrktStackSecret:()=>_e,name:()=>qe,persistentStateOptions:()=>Ye,snitchSocket:()=>Ve,trdvtCid:()=>Ie,trdvtPassword:()=>Je,trdvtSecret:()=>je,trdvtUsername:()=>ze,urlMrktStack:()=>Ue,urlTrdvt:()=>Re,version:()=>Le});var o={};t.r(o),t.d(o,{daysBetween:()=>cn,generateDateRange:()=>dn,isPreTradingHour:()=>on,isTradingDay:()=>an,isTradingHour:()=>rn,isYesterday:()=>un,lastTradingDay:()=>sn,nextDay:()=>ln,prevDay:()=>fn});var a={};t.r(a),t.d(a,{getLatestPrice:()=>Pn,initialize:()=>hn,subscribeClientSocket:()=>_n,unsubscribeClientSocket:()=>Rn,updatePrices:()=>Un});var s={};t.r(s),t.d(s,{getStockAllHistory:()=>qn,getStockNewerHistory:()=>Fn,getStockOlderHistory:()=>Ln,initialize:()=>Hn,startLiveDataHeartbeat:()=>Bn});var u={};t.r(u),t.d(u,{initialize:()=>$r,load:()=>Sr,remove:()=>Or,save:()=>br});var l={};t.r(l),t.d(l,{initialize:()=>Mr});var f={};t.r(f),t.d(f,{forceLoadNewestStockData:()=>Br,getData:()=>qr,initialize:()=>Hr});var c={};t.r(c);var d={};t.r(d),t.d(d,{prepareAndExpose:()=>ji});var h={};t.r(h),t.d(h,{serviceStartup:()=>Li});var g={};t.r(g),t.d(g,{initialize:()=>Fi,startSession:()=>Qi});var y,p,v={};t.r(v),t.d(v,{onConnect:()=>Xi}),p=function(t){return JSON.stringify(t,null,4)},y={};var m,w,b,S=function(t){var e,n;return n=function(t){return e("\n"+p(t))},{log:e=function(e){y[t]&&console.log("["+t+"]: "+e)},olog:n}};({log:w,olog:b}=S("accessmodule")),m=Object.create(null);var O=function(t){w("initialize"),t.fallbackAuthCode&&(m[t.fallbackAuthCode]={})},A=function({authCode:t,ttlMS:e}){var n,r;w("setAccess"),w(t),w(e),n=function(){return E(t)},null!=(r=m[t])?clearTimeout(r.deathTimerId):r={},r.deathTimerId=setTimeout(n,e),m[t]=r},E=function(t){var e;w("unsetAccess"),null!=(e=m[t])&&(clearTimeout(e.deathTimerId),delete m[t])},$=function(t){return null!=m[t]};const{p:C,n:T,Gx:D,Gy:k,a:x,d:N}={p:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,n:0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,h:8n,a:0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,d:0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,Gx:0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy:0x6666666666666666666666666666666666666666666666666666666666666658n},j=(t="")=>{throw new Error(t)},I=t=>"string"==typeof t,z=(t,e)=>!(t=>t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name)(t)||"number"==typeof e&&e>0&&t.length!==e?j("Uint8Array expected"):t,J=t=>new Uint8Array(t),_=t=>Uint8Array.from(t),R=(t,e)=>t.toString(16).padStart(e,"0"),U=t=>Array.from(z(t)).map(t=>R(t,2)).join(""),P=t=>t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:void 0,M=t=>{const e="hex invalid";if(!I(t))return j(e);const n=t.length,r=n/2;if(n%2)return j(e);const i=J(r);for(let n=0,o=0;n<r;n++,o+=2){const r=P(t.charCodeAt(o)),a=P(t.charCodeAt(o+1));if(void 0===r||void 0===a)return j(e);i[n]=16*r+a}return i},H=(t,e)=>z(I(t)?M(t):_(z(t)),e),B=()=>globalThis?.crypto,q=(...t)=>{const e=J(t.reduce((t,e)=>t+z(e).length,0));let n=0;return t.forEach(t=>{e.set(t,n),n+=t.length}),e},L=BigInt,F=(t,e,n,r="bad number: out of range")=>(t=>"bigint"==typeof t)(t)&&e<=t&&t<n?t:j(r),V=(t,e=C)=>{const n=t%e;return n>=0n?n:e+n},G=(t,e)=>{(0n===t||e<=0n)&&j("no inverse n="+t+" mod="+e);let n=V(t,e),r=e,i=0n,o=1n,a=1n,s=0n;for(;0n!==n;){const t=r/n,e=r%n,u=i-a*t,l=o-s*t;r=n,n=e,i=a,o=s,a=u,s=l}return 1n===r?V(i,e):j("no inverse")},Z=t=>t instanceof W?t:j("Point expected"),Y=2n**256n;class W{static BASE;static ZERO;ex;ey;ez;et;constructor(t,e,n,r){const i=Y;this.ex=F(t,0n,i),this.ey=F(e,0n,i),this.ez=F(n,1n,i),this.et=F(r,0n,i),Object.freeze(this)}static fromAffine(t){return new W(t.x,t.y,1n,V(t.x*t.y))}static fromBytes(t,e=!1){const n=N,r=_(z(t,32)),i=t[31];r[31]=-129&i;const o=tt(r);F(o,0n,e?Y:C);const a=V(o*o),s=V(a-1n),u=V(n*a+1n);let{isValid:l,value:f}=rt(s,u);l||j("bad point: y not sqrt");const c=1n==(1n&f),d=!!(128&i);return!e&&0n===f&&d&&j("bad point: x==0, isLastByteOdd"),d!==c&&(f=V(-f)),new W(f,o,1n,V(f*o))}assertValidity(){const t=x,e=N;if(this.is0())throw new Error("bad point: ZERO");const{ex:n,ey:r,ez:i,et:o}=this,a=V(n*n),s=V(r*r),u=V(i*i),l=V(u*u),f=V(a*t);if(V(u*V(f+s))!==V(l+V(e*V(a*s))))throw new Error("bad point: equation left != right (1)");if(V(n*r)!==V(i*o))throw new Error("bad point: equation left != right (2)");return this}equals(t){const{ex:e,ey:n,ez:r}=this,{ex:i,ey:o,ez:a}=Z(t),s=V(e*a),u=V(i*r),l=V(n*a),f=V(o*r);return s===u&&l===f}is0(){return this.equals(Q)}negate(){return new W(V(-this.ex),this.ey,this.ez,V(-this.et))}double(){const{ex:t,ey:e,ez:n}=this,r=x,i=V(t*t),o=V(e*e),a=V(2n*V(n*n)),s=V(r*i),u=t+e,l=V(V(u*u)-i-o),f=s+o,c=f-a,d=s-o,h=V(l*c),g=V(f*d),y=V(l*d),p=V(c*f);return new W(h,g,p,y)}add(t){const{ex:e,ey:n,ez:r,et:i}=this,{ex:o,ey:a,ez:s,et:u}=Z(t),l=x,f=N,c=V(e*o),d=V(n*a),h=V(i*f*u),g=V(r*s),y=V((e+n)*(o+a)-c-d),p=V(g-h),v=V(g+h),m=V(d-l*c),w=V(y*p),b=V(v*m),S=V(y*m),O=V(p*v);return new W(w,b,O,S)}multiply(t,e=!0){if(!e&&(0n===t||this.is0()))return Q;if(F(t,1n,T),1n===t)return this;if(this.equals(K))return ct(t).p;let n=Q,r=K;for(let i=this;t>0n;i=i.double(),t>>=1n)1n&t?n=n.add(i):e&&(r=r.add(i));return n}toAffine(){const{ex:t,ey:e,ez:n}=this;if(this.equals(Q))return{x:0n,y:1n};const r=G(n,C);return 1n!==V(n*r)&&j("invalid inverse"),{x:V(t*r),y:V(e*r)}}toBytes(){const{x:t,y:e}=this.assertValidity().toAffine(),n=X(e);return n[31]|=1n&t?128:0,n}toHex(){return U(this.toBytes())}clearCofactor(){return this.multiply(L(8n),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let t=this.multiply(T/2n,!1).double();return T%2n&&(t=t.add(this)),t.is0()}static fromHex(t,e){return W.fromBytes(H(t),e)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}toRawBytes(){return this.toBytes()}}const K=new W(D,k,1n,V(D*k)),Q=new W(0n,1n,1n,0n);W.BASE=K,W.ZERO=Q;const X=t=>M(R(F(t,0n,Y),64)).reverse(),tt=t=>L("0x"+U(_(z(t)).reverse())),et=(t,e)=>{let n=t;for(;e-- >0n;)n*=n,n%=C;return n},nt=0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n,rt=(t,e)=>{const n=V(e*e*e),r=(t=>{const e=t*t%C*t%C,n=et(e,2n)*e%C,r=et(n,1n)*t%C,i=et(r,5n)*r%C,o=et(i,10n)*i%C,a=et(o,20n)*o%C,s=et(a,40n)*a%C,u=et(s,80n)*s%C,l=et(u,80n)*s%C,f=et(l,10n)*i%C;return{pow_p_5_8:et(f,2n)*t%C,b2:e}})(t*V(n*n*e)).pow_p_5_8;let i=V(t*n*r);const o=V(e*i*i),a=i,s=V(i*nt),u=o===t,l=o===V(-t),f=o===V(-t*nt);return u&&(i=a),(l||f)&&(i=s),1n==(1n&V(i))&&(i=V(-i)),{isValid:u||l,value:i}},it=t=>{return e=tt(t),V(e,T);var e},ot=t=>((...t)=>st.sha512Async(...t))(t.hashable).then(t.finish),at={zip215:!0},st={sha512Async:async(...t)=>{const e=B()?.subtle??j("crypto.subtle must be defined"),n=q(...t);return J(await e.digest("SHA-512",n.buffer))},sha512Sync:void 0,bytesToHex:U,hexToBytes:M,concatBytes:q,mod:V,invert:G,randomBytes:(t=32)=>B().getRandomValues(J(t))},ut=Math.ceil(32)+1;let lt;const ft=(t,e)=>{const n=e.negate();return t?n:e},ct=t=>{const e=lt||(lt=(()=>{const t=[];let e=K,n=e;for(let r=0;r<ut;r++){n=e,t.push(n);for(let r=1;r<128;r++)n=n.add(e),t.push(n);e=n.double()}return t})());let n=Q,r=K;const i=L(255),o=L(8);for(let a=0;a<ut;a++){let s=Number(t&i);t>>=o,s>128&&(s-=256,t+=1n);const u=128*a,l=u,f=u+Math.abs(s)-1,c=a%2!=0,d=s<0;0===s?r=r.add(ft(c,e[l])):n=n.add(ft(d,e[f]))}return{p:n,f:r}};var dt,ht,gt;new(require("string_decoder").StringDecoder)("utf-8"),new Array(256).fill(0).map(function(t,e){return BigInt(e)}),gt=Array.from("0123456789abcdef"),ht=new Array(256),gt.forEach(function(t){return ht[t]=16*parseInt(t,16)}),dt=new Array(256),gt.forEach(function(t){return dt[t]=parseInt(t,16)});var yt,pt=function(t){var e,n,r,i;for(i=new Uint8Array(t.length/2),e=n=0,r=t.length;n<r;e=n+=2)i[e/2]=ht[t[e]]+dt[t[e+1]];return i};require("crypto"),yt=BigInt(2)**BigInt(252)+BigInt("27742317777372353535851937790883648493");var vt,mt=async function(t,e,n){var r,i,o,a;return o=pt(t),i=pt(e),a=n,r=new Uint8Array(Buffer.from(a,"utf8")),await(async(t,e,n,r=at)=>ot(((t,e,n,r=at)=>{t=H(t,64),e=H(e),n=H(n,32);const{zip215:i}=r;let o,a,s,u,l=Uint8Array.of();try{o=W.fromHex(n,i),a=W.fromHex(t.slice(0,32),i),s=tt(t.slice(32,64)),u=K.multiply(s,!1),l=q(a.toBytes(),o.toBytes(),e)}catch(t){}return{hashable:l,finish:t=>{if(null==u)return!1;if(!i&&o.isSmallOrder())return!1;const e=it(t);return a.add(o.multiply(e,!1)).add(u.negate()).clearCofactor().is0()}}})(t,e,n,r)))(o,r,i)};vt=18e4;var wt,bt,St,Ot,At,Et,$t,Ct,Tt,Dt,kt,xt,Nt,jt,It,zt,Jt,_t;for(Jt=null,zt=/^\d+$/,jt=/(\.\.|--|-\.)|\.-/,xt=new Array(103),Nt=0;Nt<22;)xt["0123456789abcdefABCDEF".charCodeAt(Nt)]=!0,Nt++;for(Ct=new Array(123),Nt=0;Nt<64;)Ct["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.".charCodeAt(Nt)]=!0,Nt++;for($t="\0\b\v\f\rÂÂ‚ÂƒÂ„Â†Â‡ÂˆÂ‰ÂŠÂ‹ÂŒÂÂŽÂÂÂ‘Â’Â“Â”Â•Â–Â—Â˜Â™ÂšÂ›ÂœÂÂžÂŸ",Et=new Array(160),Nt=0;Nt<61;)Et[$t.charCodeAt(Nt)]=!0,Nt++;It=function(t){var e,n,r,i;if(null!==t){for(e=0,i=(r=Object.keys(t)).length;e<i;e++){if("__proto__"===(n=r[e])||"constructor"===n||"prototype"===n)return!0;if("object"==typeof t[n]&&It(t[n]))return!0}return!1}},Ot=function(t){return function(e){if(e!==t)return Qt}},At=function(t){return function(){throw new Error(t)}},Tt=function(t){var e;if(null==(e=_t[t]))throw new Error(`Unrecognized Schematype! (${t})`);return e},Dt=function(t){var e,n,r,i;for(n=new Array(t.length),Nt=r=0,i=t.length;r<i;Nt=++r)switch(e=t[Nt],!1){case"number"!=typeof e:n[Nt]=Tt(e);break;case"string"!=typeof e:n[Nt]=Jt(e);break;case"object"==typeof e:throw new Error(`Illegal ${typeof e}!`);case!Array.isArray(e):n[Nt]=bt(e);break;default:n[Nt]=St(e)}return n},kt=function(t){var e,n,r,i,o,a;for(i=Object.keys(t),e=[],Nt=n=0,o=i.length;n<o;Nt=++n)if("number"!=typeof(a=t[r=i[Nt]]))if("string"!=typeof a){if("object"!=typeof a)throw new Error(`Illegal ${typeof a}!`);Array.isArray(a)?e.push([r,bt(a)]):e.push([r,St(a)])}else e.push([r,Jt(a)]);else e.push([r,Tt(a)]);return e},bt=function(t){var e,n;if(0===t.length)throw new Error("[] is illegal!");return n=Dt(t),e=function(t){var e,r,i,o,a,s;if(!Array.isArray(t))return Qt;for(o=0,Nt=a=0,s=n.length;a<s;Nt=++a)if(i=n[Nt],void 0!==(e=t[Nt])&&o++,r=i(e))return r;return t.length>o?Qt:void 0},e},St=function(t){var e,n;if(null===t)throw new Error("null is illegal!");if(0===(n=kt(t)).length)throw new Error("{} is illegal!");return e=function(t){var e,r,i,o,a,s;if("object"!=typeof t)return Qt;if(null===t)return Qt;for(i=0,o=0,a=n.length;o<a;o++)if(void 0!==(s=t[(e=n[o])[0]])&&i++,r=e[1](s))return r;return Object.keys(t).length>i?Qt:void 0},e},(_t=new Array(47))[5]=function(t){if("string"!=typeof t)return Rt},_t[6]=function(t){var e,n,r,i,o,a,s;if("string"!=typeof t)return Rt;if(t.length>320||t.length<5)return Lt;if(jt.test(t))return qt;if((e=t.indexOf("@"))<=0||e>64||t.length-e<4||"."===t[0]||"."===t[e-1]||"-"===t[0]||"-"===t[e-1]||"."===t[e+1]||"-"===t[e+1])return qt;for(Nt=i=0,a=t.length;i<a;Nt=++i)if(n=t[Nt],!(Ct[t.charCodeAt(Nt)]||Nt===e||Nt<e&&("+"===n||"_"===n)))return qt;if("."===t[t.length-1]||"-"===t[t.length-1])return qt;if(o=e,(r=t.indexOf(".",e+1))<0)return qt;for(;r>0;){if(r-o>63)return qt;o=r,r=t.indexOf(".",o+1)}return s=t.slice(o+1),zt.test(s)?qt:void 0},_t[7]=function(t){if("string"!=typeof t)return Rt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[8]=function(t){if("string"!=typeof t)return Rt;if(32!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[9]=function(t){if("string"!=typeof t)return Rt;if(64!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[10]=function(t){if("string"!=typeof t)return Rt;if(128!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[11]=function(t){if("string"!=typeof t)return Rt;if(256!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[12]=function(t){if("string"!=typeof t)return Rt;if(512!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[2]=function(t){return"number"!=typeof t?Ut:isNaN(t)?Ft:Infinity===t||-Infinity===t?Kt:void 0},_t[1]=function(t){if("boolean"!=typeof t)return Pt},_t[3]=function(t){if(!Array.isArray(t))return Mt},_t[4]=function(t){if("object"!=typeof t)return Ht},_t[21]=function(t){if(void 0!==t)return"string"!=typeof t?Rt:void 0},_t[22]=function(t){var e,n,r,i,o,a,s;if(void 0!==t){if("string"!=typeof t)return Rt;if(t.length>320||t.length<5)return Lt;if(jt.test(t))return qt;if((e=t.indexOf("@"))<=0||e>64||t.length-e<4||"."===t[0]||"."===t[e-1]||"-"===t[0]||"-"===t[e-1]||"."===t[e+1]||"-"===t[e+1])return qt;for(Nt=i=0,a=t.length;i<a;Nt=++i)if(n=t[Nt],!(Ct[t.charCodeAt(Nt)]||Nt===e||Nt<e&&("+"===n||"_"===n)))return qt;if("."===t[t.length-1]||"-"===t[t.length-1])return qt;if(o=e,(r=t.indexOf(".",e+1))<0)return qt;for(;r>0;){if(r-o>63)return qt;o=r,r=t.indexOf(".",o+1)}return s=t.slice(o+1),zt.test(s)?qt:void 0}},_t[23]=function(t){if(void 0!==t){if("string"!=typeof t)return Rt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[24]=function(t){if(void 0!==t){if("string"!=typeof t)return Rt;if(32!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[25]=function(t){if(void 0!==t){if("string"!=typeof t)return Rt;if(64!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[26]=function(t){if(void 0!==t){if("string"!=typeof t)return Rt;if(128!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[27]=function(t){if(void 0!==t){if("string"!=typeof t)return Rt;if(256!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[28]=function(t){if(void 0!==t){if("string"!=typeof t)return Rt;if(512!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[30]=function(t){if(void 0!==t)return"number"!=typeof t?Ut:isNaN(t)?Ft:Infinity===t||-Infinity===t?Kt:void 0},_t[31]=function(t){if(void 0!==t)return"boolean"!=typeof t?Pt:void 0},_t[32]=function(t){if(void 0!==t)return Array.isArray(t)?void 0:Mt},_t[33]=function(t){if(void 0!==t)return"object"!=typeof t?Ht:void 0},_t[35]=function(t){if(null!==t)return"string"!=typeof t?Rt:void 0},_t[36]=function(t){var e,n,r,i,o,a,s;if(null!==t){if("string"!=typeof t)return Rt;if(t.length>320||t.length<5)return Lt;if(jt.test(t))return qt;if((e=t.indexOf("@"))<=0||e>64||t.length-e<4||"."===t[0]||"."===t[e-1]||"-"===t[0]||"-"===t[e-1]||"."===t[e+1]||"-"===t[e+1])return qt;for(Nt=i=0,a=t.length;i<a;Nt=++i)if(n=t[Nt],!(Ct[t.charCodeAt(Nt)]||Nt===e||Nt<e&&("+"===n||"_"===n)))return qt;if("."===t[t.length-1]||"-"===t[t.length-1])return qt;if(o=e,(r=t.indexOf(".",e+1))<0)return qt;for(;r>0;){if(r-o>63)return qt;o=r,r=t.indexOf(".",o+1)}return s=t.slice(o+1),zt.test(s)?qt:void 0}},_t[37]=function(t){if(null!==t){if("string"!=typeof t)return Rt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[38]=function(t){if(null!==t){if("string"!=typeof t)return Rt;if(32!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[39]=function(t){if(null!==t){if("string"!=typeof t)return Rt;if(64!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[40]=function(t){if(null!==t){if("string"!=typeof t)return Rt;if(128!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[41]=function(t){if(null!==t){if("string"!=typeof t)return Rt;if(256!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[42]=function(t){if(null!==t){if("string"!=typeof t)return Rt;if(512!==t.length)return Lt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}}},_t[44]=function(t){if(null!==t)return"number"!=typeof t?Ut:isNaN(t)?Ft:Infinity===t||-Infinity===t?Kt:void 0},_t[45]=function(t){if(null!==t)return"boolean"!=typeof t?Pt:void 0},_t[46]=function(t){if(null!==t)return Array.isArray(t)?void 0:Mt},_t[19]=function(t){return"object"!=typeof t?Ht:null===t?Vt:void 0},_t[14]=function(t){return"string"!=typeof t?Rt:0===t.length?Gt:void 0},_t[17]=function(t){return Array.isArray(t)?0===t.length?Zt:void 0:Mt},_t[15]=function(t){if("string"!=typeof t)return Rt;if(0===t.length)return Gt;for(Nt=0;Nt<t.length;){if(void 0===xt[t.charCodeAt(Nt)])return Bt;Nt++}},_t[16]=function(t){var e;if("string"!=typeof t)return Rt;if(0===t.length)return Gt;for(Nt=0;Nt<t.length;){if((e=t.charCodeAt(Nt))>767||Et[e])return Yt;Nt++}},_t[13]=function(t){var e;if("string"!=typeof t)return Rt;for(Nt=0;Nt<t.length;){if((e=t.charCodeAt(Nt))>767||Et[e])return Yt;Nt++}},_t[43]=function(t){var e;if(null!==t){if("string"!=typeof t)return Rt;for(Nt=0;Nt<t.length;){if((e=t.charCodeAt(Nt))>767||Et[e])return Yt;Nt++}}},_t[29]=function(t){var e;if(void 0!==t){if("string"!=typeof t)return Rt;for(Nt=0;Nt<t.length;){if((e=t.charCodeAt(Nt))>767||Et[e])return Yt;Nt++}}},_t[18]=function(t){return"object"!=typeof t?Ht:It(t)?Wt:void 0},_t[20]=function(t){return"object"!=typeof t?Ht:null===t?Vt:It(t)?Wt:void 0},_t[34]=function(t){if(void 0!==t)return"object"!=typeof t?Ht:It(t)?Wt:void 0};var Rt=1e3,Ut=1001,Pt=1002,Mt=1003,Ht=1004,Bt=1005,qt=1006,Lt=1007,Ft=1008,Vt=1009,Gt=1010,Zt=1011,Yt=1012,Wt=1013,Kt=1014,Qt=2222;(wt=Object.create(null))[Rt]="Not a String!",wt[Ut]="Not a Number!",wt[Pt]="Not a Boolean!",wt[Mt]="Not an Array!",wt[Ht]="Not an Object!",wt[Bt]="String is not valid hex!",wt[qt]="String is not a valid email!",wt[Lt]="String size mismatch!",wt[Ft]="Number is NaN!",wt[Vt]="Object is null!",wt[Gt]="String is empty!",wt[Zt]="Array is empty!",wt[Yt]="String is dirty!",wt[Wt]="Object is dirty!",wt[Kt]="Number is not finite!",wt[Qt]="Is invalid!";var Xt,te,ee,ne,re=function(t,e){var n;if(Jt=!0===e?Ot:At("Static string!"),"number"==(n=typeof t))return Tt(t);if("string"===n)return Jt(t);if("object"!==n)throw new Error(`Illegal ${typeof t}!`);return Array.isArray(t)?bt(t):St(t)};({log:ee,olog:ne}=S("earlyblockermodule")),te=new Set,Xt=new Set;var ie,oe,ae,se,ue,le,fe,ce=function(t){var e,n,r,i,o;for(ee("initialize"),n=0,r=(o=t.legalOrigins).length;n<r;n++)i=o[n],te.add(i);e=new Array(...te),ee(`legalOrigins: ${e}`)},de=function(t,e){return ee("isBlocked"),Xt.has(t)?(ee(`blocked request with IP: ${t}`),"IP blocked!"):te.has(e)?void ee("passed!"):(ee(`blocked request with origin: ${e}`),Xt.add(t),"Illegal Origin!")},he=function(t){return Xt.add(t)};({log:oe,olog:se}=S("authmodule")),ie=null,le=6e5,fe=re({senderId:9,timestamp:2,nonce:2,signature:10}),ae=Object.create(null);var ge=function(t){oe("initialize"),ie=t.accessManagerId,setInterval(ue,le)};ue=function(){var t,e;for(t in e=Date.now(),ae)ae[t]<e&&delete ae[t]};var ye=async function(t,e){var n,r,i,o,a;return oe("signatureAuth"),se(e),r=e.meta.ip,n=e.meta.host,de(r,n)?"Client Blocked!":fe(e.auth)?"Invalid Auth Object!":e.auth.senderId!==ie?"Unauthorized Sender!":function(t){var e,n;if(t!==(n=(e=Date.now())-e%vt)&&t!==(n-=vt))return t!==(n+=36e4)?"invalid":void 0}(e.auth.timestamp)?"Invalid Timestamp!":(i=e.auth.nonce,null!=ae[i]?"Nonce used already!":(ae[i]=Date.now()+le,o=e.auth.signature,a=e.bodyString.replace(o,"\"'\\"),await mt(o,ie,a)?void oe("We have a fully authorized Request!"):"Invalid Signature!"))};const pe=require("node:path");var ve=t.n(pe);const me=require("node:fs");var we=t.n(me);const be=require("node:net");var Se,Oe,Ae,Ee,$e,Ce=t.n(be);({log:Se,olog:Oe}=S("bugsnitch")),Ae=new Promise(function(t){return t}),$e="unnamed",Ee=async function(t){var e;Se("sendToBugsnitch"),await Ae,(e=Ce().createConnection("/run/bugsnitch.sk")).on("connect",function(){return e.end(t)}),e.on("error",function(t){return console.error(t)}),e.on("close",function(){return Se("Connection closed!")})};var Te,De,ke,xe,Ne=function(t){var e,n;if(Se("report"),console.error(t),"string"!=typeof t)try{return n=`[${$e}] Error: `+t.message,t.cause&&(n+="\n Cause: "+t.cause),t.stack&&(n+="\n Stack: "+t.stack),void Ee(n)}catch(t){e=t,console.error("bugsnitch.report: unexpected errorObject!\n "+e.message)}else Ee(n=`[${$e}]: ${t}`)};De=Object.create(null);try{Te=ve().resolve(process.cwd(),"./.config.json"),ke=we().readFileSync(Te,"utf8"),De=JSON.parse(ke)}catch(t){xe="@configmodule - config parsing:\n",xe+=" Local Config File could not be read or parsed!\n ",xe+=t.message,Ne(xe)}var je=De.secret||"none",Ie=De.cid||"none",ze=De.name||"none",Je=De.password||"none",_e=De.mrktStackSecret||"none",Re="https://live.tradovateapi.com/v1",Ue="https://api.marketstack.com/v2",Pe=6e5,Me=36e5,He=["HYG"],Be=3e4,qe="Sentinel Datahub",Le="v0.0.1",Fe=De.accessManagerId||"",Ve=De.snitchSocket||"/run/bugsnitch.sk",Ge=["localhost","localhost:3333","sentinel-dashboard-dev.dotv.ee","sentinel-datahub.dotv.ee","sentinel.ewag-handelssysteme.de"],Ze="aaaaaaaabbbbbbbbccccccccdddddddd",Ye={basePath:"../state",maxCacheSize:128};De=null;var We,Ke,Qe,Xe,tn,en,nn,rn=function(t=new Date){var e;return(e=(t.getUTCHours()+19)%24*60+t.getUTCMinutes())>=420&&e<960},on=function(t=new Date){return!0},an=function(t=new Date){var e;return 0!==(e=t.getUTCDay())&&6!==e},sn=function(t=new Date){var e;for(e=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()));0===e.getUTCDay()||6===e.getUTCDay();)e.setUTCDate(e.getUTCDate()-1);return e.toISOString().substring(0,10)},un=function(t){var e;return e=new Date,t===new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()-1)).toISOString().substring(0,10)},ln=function(t){var e;return(e=new Date(t+"T00:00:00Z")).setUTCDate(e.getUTCDate()+1),e.toISOString().substring(0,10)},fn=function(t){var e;return(e=new Date(t+"T00:00:00Z")).setUTCDate(e.getUTCDate()-1),e.toISOString().substring(0,10)},cn=function(t,e){var n,r;return r=new Date(t+"T00:00:00Z"),n=new Date(e+"T00:00:00Z"),Math.floor((n-r)/864e5)},dn=function(t,e){var n,r,i;for(r=[],n=new Date(t+"T00:00:00Z"),i=new Date(e+"T00:00:00Z");n<=i;)r.push(n.toISOString().substring(0,10)),n.setUTCDate(n.getUTCDate()+1);return r};({log:Qe,olog:tn}=S("livefeedmodule")),Ke=Object.create(null),nn=Object.create(null),en=new Map,We=new Set;var hn=function(t){var e,n,r,i;if(Qe("initialize"),null!=t.liveDataSymbols)for(e=0,n=(r=t.liveDataSymbols).length;e<n;e++)i=r[e],We.add(i)};Xe=function(t){var e,n,r,i,o,a,s;for(Qe("notifySubscribers"),n=0,r=t.length;n<r;n++)if(s=t[n],o=Ke[s],null!=(e=nn[s]))for(a of(i=`liveDataUpdate ${s} ${o}`,e))try{a.send(i)}catch(t){Qe(`A certain socket could not be notified! ${t.message}`)}};var gn,yn,pn,vn,mn,wn,bn,Sn,On,An,En,$n,Cn,Tn,Dn,kn,xn,Nn,jn,In,zn,Jn,_n=function(t,e){var n,r;Qe("subscribeClientSocket"),We.has(e)&&(null==(r=en.get(t))&&(r=new Set,en.set(t,r)),r.add(e),null==(n=nn[e])&&(n=new Set,nn[e]=n),n.add(t))},Rn=function(t){var e,n;if(Qe("unsubscribeClientSocket"),null!=(n=en.get(t))){for(e of n)nn[e].delete(t);en.delete(t)}},Un=function(t){var e,n,r;for(n in Qe("updatePrices"),r=Object.create(null),t)e=t[n],Ke[n]!==e&&(r[n]=!0),Ke[n]=e;tn(Ke),Xe(Object.keys(r))},Pn=function(t){var e;return null!=(e=Ke[t])?e:null},Mn=[].indexOf;({log:An,olog:$n}=S("marketstackmodule")),gn=null,yn=null,ve().resolve(".","symbols.json"),ve().resolve(".","currencies.json"),On=[],Sn=3e5,Tn=0,Dn=null;var Hn=function(t){An("initialize"),null!=t.mrktStackSecret&&(gn=t.mrktStackSecret),null!=t.urlMrktStack&&(yn=t.urlMrktStack),null!=t.liveDataSymbols&&On.push(...t.liveDataSymbols),null!=t.liveDataHeartbeatMS&&(Sn=t.liveDataHeartbeatMS)};bn=async function(){var t,e,n,r,i,o,a,s,u,l,f,c,d,h,g,y,p;if(An("realTimeHeartbeat"),n=new Date,an(n))if(An("Today is a trading-day - let's see what's up..."),rn(n)){if(An("isTradingHour: true"),null==gn||null==yn)return;if(0===On.length)return;try{if(t=On.map(function(t){return t.replace(/\./g,"-")}).join(","),u=new URLSearchParams({access_key:gn,symbols:t}),p=`${yn}/intraday/latest?${u.toString()}`,null!=(e=await jn(p)).error)return void An(`liveData API error: ${e.error.code}: ${e.error.message}`);for(o=Object.create(null),f=null!=(l=e.data)?l:[],r=0,a=f.length;r<a;r++)null!=(h=f[r]).symbol&&(o[g=h.symbol.replace(/-/g,".")]=null!=(c=null!=(d=h.last)?d:h.lastPrice)?c:h.close);try{Un(o)}catch(t){An(`error in liveFeed.updatePrices! ${t.message}`)}}catch(t){An(`liveData retrieval error: ${t.message}`)}}else if(on(n)){if(An("isPreTradingHour: true"),y=n.toISOString().substring(0,10),Dn!==y&&(Dn=y,Tn=0),Tn>=3)return void An("Pre-trade attempt limit reached (3) - skipping");for(Tn++,An(`Pre-trade attempt ${Tn}/3`),i=0,s=On.length;i<s;i++)g=On[i],Br(g)}else An("It's not an interesting time - we do nothing here :-)")};var Bn=function(){An("startLiveDataHeartbeat"),setInterval(bn,Sn)},qn=async function(t){var e,n,r;return An(`getStockAllHistory: ${t}`),null==(r=await pn(t))?null:(null!=r.error&&(n=r.error,wn(n)?An(`Plan limit reached: ${n.code}`):An(`API error: ${n.code}: ${n.message}`)),0===r.data.length?(An("No data received"),null):(e=En(r.data,t),(e=mn(e)).meta.historyComplete=null==r.error,An(`Returning ${e.data.length} data points, historyComplete: ${e.meta.historyComplete}`),e))},Ln=async function(t,e){var n,r,i,o;return An(`getStockOlderHistory: ${t} olderThan=${e}`),r=fn(e),null==(o=await pn(t,{date_to:r}))?null:(null!=o.error&&(i=o.error,wn(i)?An(`Plan limit reached: ${i.code}`):An(`API error: ${i.code}: ${i.message}`)),0===o.data.length?(An("No older data available"),null):(n=En(o.data,t),(n=mn(n)).meta.historyComplete=null==o.error,An(`Returning ${n.data.length} older data points`),n))},Fn=async function(t,e){var n,r,i,o;return An(`getStockNewerHistory: ${t} newerThan=${e}`),r=ln(e),null==(o=await pn(t,{date_from:r}))?null:(null!=o.error&&(i=o.error,wn(i)?An(`Plan limit reached: ${i.code}`):An(`API error: ${i.code}: ${i.message}`)),0===o.data.length?(An("No newer data available"),null):(n=En(o.data,t),n=mn(n),An(`Returning ${n.data.length} newer data points`),n))};pn=async function(t,e={}){var n,r,i,o,a;An(`fetchAllEodPages: ${t}`),n=[],i=0;try{for(;;){if(null!=(r=(o=await vn(t,{offset:i,limit:1e3,...e})).error))return{error:r,data:n};if(n.push(...o.data),a=o.pagination,n.length>=a.total)return{data:n};i+=1e3}}catch(t){return An(r=t)}},vn=async function(t,{offset:e,limit:n,date_from:r,date_to:i}){var o,a,s,u,l;An(`fetchEodPage: ${t} offset=${e}`),o=t.replace(/\./g,"-"),u=new URLSearchParams({access_key:gn,symbols:o,sort:"ASC",limit:n.toString(),offset:e.toString()}),null!=r&&u.set("date_from",r),null!=i&&u.set("date_to",i),l=`${yn}/eod?${u.toString()}`;try{a=await jn(l)}catch(t){return An(`Network/parse error: ${(s=t).message}`),{error:{code:"network_error",message:s.message}}}return null!=a.error?{error:a.error}:{data:a.data,pagination:a.pagination}},En=function(t,e){var n,r,i,o,a,s;if(An(`normalizeEodResponse: ${t.length} records`),0===t.length)return null;for(n=[],i=1,o=0,a=t.length;o<a;o++)r=(s=t[o]).date.substring(0,10),i*=s.split_factor,n.push({date:r,high:s.high*i,low:s.low*i,close:s.close*i});return{meta:{startDate:n[0].date,endDate:n[n.length-1].date,interval:"1d"},data:n.map(function(t){return[t.high,t.low,t.close]}),_dates:n.map(function(t){return t.date})}},mn=function(t){var e,n,r,i,o,a,s,u,l,f,c,d,h;if(An("gapFillDataSet"),null==t||0===t.data.length)return t;for(({meta:d,data:r,_dates:e}=t),o={},s=u=0,h=e.length;0<=h?u<h:u>h;s=0<=h?++u:--u)o[e[s]]=r[s];for(n=dn(d.startDate,d.endDate),a=[],f=r[0][2],l=0,c=n.length;l<c;l++)null!=o[i=n[l]]?(a.push(o[i]),f=o[i][2]):a.push([f,f,f]);return{meta:d,data:a}},wn=function(t){var e,n;return e=["function_access_restricted","https_access_restricted","usage_limit_reached"],n=t.code,Mn.call(e,n)>=0},Nn=[],Cn=new Map,xn=!1,Jn=0,zn=0,jn=function(t){return new Promise(function(e,n){if(!Cn.has(t))return Cn.set(t,[{resolve:e,reject:n}]),Nn.push(t),xn?void 0:kn();Cn.get(t).push({resolve:e,reject:n})})},kn=async function(){var t,e,n,r,i,o,a,s,u,l;if(!xn&&0!==Nn.length){for(xn=!0;Nn.length>0;){0===zn&&(Jn=performance.now()),zn++,u=Nn.shift(),l=Cn.get(u);try{for(s=await fetch(u),t=await s.json(),Cn.delete(u),n=0,i=l.length;n<i;n++)l[n].resolve(t)}catch(t){for(e=t,Cn.delete(u),r=0,o=l.length;r<o;r++)l[r].reject(e)}zn>=5&&((a=1001-(performance.now()-Jn))>0&&await In(a),zn=0)}xn=!1}},In=function(t){return new Promise(function(e){return setTimeout(e,t)})};const Vn=require("path");var Gn=t.n(Vn);const Zn=require("fs");var Yn,Wn,Kn,Qn,Xn,tr,er=t.n(Zn);Kn=er().promises,Wn=null;var nr,rr,ir,or,ar,sr,ur,lr,fr,cr,dr,hr,gr,yr,pr,vr=function(t){var e;null==t&&(t="./state"),e=Gn().isAbsolute(t)?t:Gn().resolve(process.cwd(),t),Wn=e,er().existsSync(Wn)||er().mkdirSync(Wn)};Xn=function(t){var e;return e=t+".json",Gn().resolve(Wn,e)},Qn=function(t){return t+".backup"},Yn=function(t){var e,n;e=Qn(t);try{er().copyFileSync(t,e)}catch(e){throw n="Error: backing up state failed!\n",n+="file: "+t+"\n",n+="reason: "+e.message,new Error(n)}},tr=function(t){var e,n,r,i;i=Xn(t),e=Qn(i);try{return n=er().readFileSync(e,"utf-8"),r=JSON.parse(n),Kn.writeFile(i,n),{contentObj:r,contentJson:n}}catch(t){return{contentObj:r=null,contentJson:n=null}}},({log:dr,olog:yr}=S("statecachemodule")),lr={},gr={},rr=null,or=null,ur={},ir=0,hr=64,sr=null,nr=class{constructor(t){this.id=t,this.nextEntry=null,this.previousEntry=rr,null==or&&(or=this),null!=rr&&(rr.nextEntry=this),rr=this,ur[this.id]=this,++ir>hr&&ar()}touch(){null!=this.nextEntry&&(null!=this.previousEntry?(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry):(or=this.nextEntry,this.nextEntry.previousEntry=null),this.nextEntry=null,this.previousEntry=rr,null!=rr&&(rr.nextEntry=this),rr=this)}remove(){return null!=this.nextEntry&&null!=this.previousEntry&&(this.nextEntry.previousEntry=this.previousEntry,this.previousEntry.nextEntry=this.nextEntry),null==this.nextEntry&&null==this.previousEntry&&(rr=null,or=null),null!=this.nextEntry&&null==this.previousEntry&&(this.nextEntry.previousEntry=null,or=this.nextEntry),null==this.nextEntry&&null!=this.previousEntry&&(this.previousEntry.nextEntry=null,rr=this.previousEntry),pr(this.id)}toString(){var t;return t=this.id+"\n",null!=this.nextEntry?t+="  next: "+this.nextEntry.id+"\n":t+="  next: null\n",null!=this.previousEntry?t+="  previous: "+this.previousEntry.id+"\n":t+="  previous: null\n",t}},fr=function(t){var e,n;new nr(t),({contentObj:n,contentJson:e}=function(t){var e,n;n=Xn(t);try{return e=er().readFileSync(n,"utf-8"),{contentObj:JSON.parse(e),contentJson:e}}catch(e){return tr(t)}}(t)),null!=n?(lr[t]=e,gr[t]=n):cr(t)},cr=function(t){null==sr||null==sr[t]?(lr[t]="{}",gr[t]={}):(lr[t]=JSON.stringify(sr[t]),gr[t]=JSON.parse(lr[t]))},pr=function(t){delete gr[t],delete lr[t],delete ur[t],ir--},ar=function(){var t;null!=(t=or)&&(null!=(or=t.nextEntry)&&(or.previousEntry=null),pr(t.id))};var mr,wr,br=async function(t,e){var n;null!=ur[t]?ur[t].touch():new nr(t),e&&(gr[t]=e),(n=JSON.stringify(gr[t]))!==lr[t]&&(lr[t]=n,await function(t,e){var n;n=Xn(t),er().writeFileSync(n,e),Yn(n)}(t,n))},Sr=function(t){return null==gr[t]?fr(t):ur[t].touch(),gr[t]},Or=async function(t){var e;null!=(e=ur[t])&&(e.remove(),await async function(t){var e,n,r,i;i=Xn(t),e=Qn(i),n=Kn.unlink(i),r=Kn.unlink(e);try{await Promise.all([n,r])}catch(t){return}}(t))};({log:mr,olog:wr}=S("storagemodule"));var Ar,Er,$r=function(t){var e;mr("initialize"),(e=t.persistentStateOptions)?(sr=e.defaultState,null!=e.maxCacheSize&&(hr=e.maxCacheSize),vr(e.basePath)):vr()};({log:Ar,olog:Er}=S("symbolsmodule"));var Cr,Tr,Dr,kr,xr,Nr,jr,Ir,zr,Jr,_r,Rr,Ur,Pr,Mr=function(){Ar("initialize")};({log:Jr,olog:_r}=S("datamodule")),Pr=function(t){return`did:${t.replace(".","-")}`},Dr=5;var Hr=function(t){Jr("initialize"),null!=t.freshnessThreshold&&(Dr=t.freshnessThreshold)},Br=async function(t){var e,n,r,i,o,a;if(r=Pr(t),null==(e=Sr(r)).data)return null!=(e=await qn(t))&&br(r,e),e;o=new Date,a=new Date(Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()-1)),n=sn(a),e.meta.endDate<n&&null!=(i=await Fn(t,e.meta.endDate))&&(e=Cr(e,i),br(r,e)),e.meta.endDate>=n?Jr(`Data is up to date (ends: ${e.meta.endDate}, expected: ${n})`):Jr(`Data still behind expected (ends: ${e.meta.endDate}, expected: ${n})`)},qr=async function(t,e){var n;return Jr(`getData ${t}, yearsBack: ${e}`),n=jr(t)?kr(t):Ir(t)?xr(t):await Nr(t),Ur(n,e)};Ur=function(t,e){var n,r,i;return null==e||null==(null!=t?t.data:void 0)?t:(r=new Date,(n=new Date(Date.UTC(r.getUTCFullYear()-e,r.getUTCMonth(),r.getUTCDate())))<=new Date(t.meta.startDate+"T00:00:00Z")||(i=cn(t.meta.startDate,n.toISOString().slice(0,10)))<=0?t:{meta:{startDate:n.toISOString().slice(0,10),endDate:t.meta.endDate,interval:t.meta.interval,historyComplete:!1},data:t.data.slice(i)})},jr=function(t){return Jr("isCommodityName"),!1},Ir=function(t){return Jr("isForexPair"),!1},Nr=async function(t){var e,n,r,i;return Jr(`getStockData ${t}`),n=Pr(t),null==(e=Sr(n)).data?(null!=(e=await qn(t))&&br(n,e),e):(e.meta.historyComplete||null!=(i=await Ln(t,e.meta.startDate))&&(e=Rr(i,e),br(n,e)),zr(e,Dr)||null!=(r=await Fn(t,e.meta.endDate))&&(e=Cr(e,r),br(n,e)),e)},zr=function(t,e){var n,r,i;return null!=(null!=t&&null!=(i=t.meta)?i.endDate:void 0)&&(n=new Date(t.meta.endDate+"T00:00:00Z"),r=new Date,Math.floor((r-n)/864e5)<=e)},Rr=function(t,e){var n,r,i,o;return r=[],n=ln(t.meta.endDate),(i=cn(n,e.meta.startDate))>0&&(Jr(`WARNING: gap detected between ${t.meta.endDate} and ${e.meta.startDate}`),o=t.data[t.data.length-1][2],r=Tr(i,o)),i<0&&(Jr("WARNING: gap was negative! This should NEVER happen!"),t.data=t.data.slice(0,i)),{meta:{startDate:t.meta.startDate,endDate:e.meta.endDate,interval:e.meta.interval,historyComplete:t.meta.historyComplete},data:[...t.data,...r,...e.data]}},Cr=function(t,e){var n,r,i,o;return r=[],n=ln(t.meta.endDate),(i=cn(n,e.meta.startDate))>0&&(Jr(`WARNING: gap detected between ${t.meta.endDate} and ${e.meta.startDate}`),o=t.data[t.data.length-1][2],r=Tr(i,o)),i<0&&(Jr("WARNING: gap was negative! This should NEVER happen!"),e.data=e.data.slice(Math.abs(i))),{meta:{startDate:t.meta.startDate,endDate:e.meta.endDate,interval:t.meta.interval,historyComplete:t.meta.historyComplete},data:[...t.data,...r,...e.data]}},Tr=function(t,e){return Array(t).fill([e,e,e])},kr=function(t){var e;return Jr("getCommodityData"),e=Pr(t),Sr(e)},xr=function(t){return Jr("getForexPairData"),Pr(t),{}},function(t){var e;for(e in t)t[e]&&(y[e]=!0)}({datamodule:!0,livefeedmodule:!0,marketstackmodule:!0});const Lr=require("node:http");var Fr,Vr,Gr,Zr,Yr,Wr,Kr,Qr,Xr,ti,ei,ni,ri,ii,oi,ai,si,ui,li,fi,ci,di,hi,gi,yi,pi,vi,mi,wi,bi=t.n(Lr);require("node:crypto"),({log:ni,olog:ii}=S("scicoremodule")),Qr=0,ei="",vi=null,pi=Object.create(null),yi=Object.create(null),Wr=null,wi=function(){var t;null!=vi&&(t=function(){console.log("Gracefully Terminated. Bye!"),process.exit(0)},setTimeout(function(){console.log("Something is taking too long. It is getting killed now ;-) Bye!"),process.exit(0)},2e3),vi.close(t))},mi=function(t){var e,n,r;if(n=parseInt(process.env.LISTEN_FDS),r=parseInt(process.env.LISTEN_PID),process.pid===r&&n>0)return Xr(t.backlog);if("true"===process.env.SOCKETMODE)throw new Error("No Socket for SOCKETMODE!");if((e=parseInt(process.env.PORT))>0&&(t.listenOn=e),"systemd"===t.listenOn)throw new Error("option systemd failed: no Socket!");return oi(t)},Xr=function(t){var e,n,r;return ni("handleSocketActivation"),e=null,r=new Promise(function(t){return e=t}),ei="SystemD FD 3",n={fd:3},vi=vi.listen(n,t,e),r},oi=function(t){var e,n,r;return e=null,n=new Promise(function(t){return e=t}),r={backlog:t.backlog},"string"==typeof t.listenOn?(r.path=t.listenOn,ei=`unix: ${r.path}`):(r.port=t.listenOn,ei=`tcp: ${r.port}`),vi=vi.listen(r,e),n},Yr=function(t,e){console.warn("Attempt to upgrade!"),e.end("HTTP/1.1 403 Forbidden\r\n\r\n")},Vr=function(t,e){console.warn(t.message),"ECONNRESET"!==t.code&&e.writable&&e.end("HTTP/1.1 400 Bad Request\r\n\r\n")},ri=function(t,e){var n,r,i,o,a,s,u,l,f,c,d,h,g;return ni("mainRequestHandler_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-\n"),ni(`req.url: ${t.url}`),ni(`req.method: ${t.method}`),ni(`req.headers[Content-Type]: ${t.headers["content-type"]}`),ni(`req.headers[Content-Length]: ${t.headers["content-length"]}`),ni(`req.headers[Transfer-Encoding]: ${t.headers["transfer-encoding"]}`),ii(t.headers),e.on("error",function(t){return console.error(t.message)}),t.on("error",function(t){return console.error(t.message)}),"GET"!==t.method&&"POST"!==t.method?fi(e):(g=t.url,h=t.method[0],null==(c=yi[`${h}${g}`])?li(e):(i=c.bodySizeLimit||Qr,o=parseInt(t.headers["content-length"])||0,a=t.headers["content-type"],ii({cLength:o,cType:a,isJson:d="application/json"===a,hasBody:f=o>0}),d&&!f||f&&0===i?si(e):(s={meta:Kr(t),bodyString:"",bodyObj:void 0,auth:void 0,args:void 0},Object.freeze(s.meta),f?o>i?ci(e):(n=[],r=0,u=function(a){return ni("dataRead"),(r+=a.length)>i||r>o?(ii({bodyLength:r,bodySizeLimit:i,cLength:o}),ci(e),t.destroy()):n.push(a)},t.on("data",u),l=function(){if(ni("dataStreamEnd"),r!==o)return ii({bodyLength:r,cLength:o}),ci(e),t.destroy();if(s.bodyString=Buffer.concat(n,r).toString("utf8"),d)try{s.bodyObj=JSON.parse(s.bodyString)}catch(t){return si(e)}ai(t,e,c,s)},void t.on("end",l)):d?si(e):ai(t,e,c,s))))},Kr=function(t){var e,n;return n=Object.create(null),"string"==typeof(e=t.headers["x-forwarded-for"])&&e.length>6?n.ip=e.split(",")[0]:n.ip=t.socket.remoteAddress,n.host=t.headers.host,n.userAgent=t.headers["user-agent"],n},ai=async function(t,e,n,r){var i,o;ni("processRequest"),void 0===r.bodyObj?(r.auth=r.bodyString,r.args=r.bodyString):null===r.bodyObj?(r.auth=null,r.args=null):(o=r.bodyObj.auth,i=r.bodyObj.args,void 0===o&&void 0===i?(r.auth=r.bodyObj,r.args=r.bodyObj):(r.auth=o,r.args=i));try{await n.handler(t,e,r)}catch(t){di(e,t)}},Zr=function(t){var e,n,r,i,o;if(ni("compileRoutes"),null==t||"object"!=typeof t)return[];r=Object.keys(t),o=[];try{for(e=0,i=r.length;e<i;e++)n=r[e],o.push(...Gr(n,t[n]))}catch(t){throw new Error("Error on Compiling Routes: "+t.message)}return o},Gr=function(t,e){var n,r,i,o,a,s,u,l,f,c,d;if(ni(`compile ${t}`),ii(e),"/"===t[0]&&(t=t.slice(1)),o=e.func,i=e.conf,"function"!=typeof o)throw new Error(`No func for '${t}'!`);if("object"!=typeof i||null==i)throw new Error(`No conf for '${t}'!`);return l=`P/${t}`,a=null,null==i.authOption&&null==i.argsSchema&&(null==i.bodySizeLimit&&(i.bodySizeLimit=0),t.length>3&&0===t.indexOf("get")&&(a="G/",a+=t.slice(3,4).toLowerCase(),a+=t.slice(4))),n=null!=i.authOption?"1":"0",r=null!=i.argsSchema?"1":"0",c=null!=i.resultSchema?"1":"0",f=null!=i.responseAuth?"1":"0",null===Wr&&(r="0",c="0"),ni("handlerType: "+(s=`${n}${r}${c}${f}`)),u=ti[s](t,o,i),ii({postRoute:l,getRoute:a}),d={handler:u,bodySizeLimit:i.bodySizeLimit},Object.freeze(d),null!=a?[[a,d],[l,d]]:[[l,d]]},si=function(t){t.statusCode=400,t.setHeader("Content-Type","text/plain"),t.end('400 "Request Malformed!"\n'),null!=arguments[1]&&console.error(arguments[1])},ui=function(t){t.statusCode=401,t.setHeader("Content-Type","text/plain"),t.end('401 "Not Authorized!"\n'),null!=arguments[1]&&console.error(arguments[1])},li=function(t){t.statusCode=404,t.setHeader("Content-Type","text/plain"),t.end('404 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},fi=function(t){t.statusCode=405,t.setHeader("Content-Type","text/plain"),t.end('405 "No Endpoint here!"\n'),null!=arguments[1]&&console.error(arguments[1])},ci=function(t){t.statusCode=413,t.setHeader("Content-Type","text/plain"),t.end('413 "Payload too large!"\n'),null!=arguments[1]&&console.error(arguments[1])},di=function(t){t.statusCode=500,t.setHeader("Content-Type","text/plain"),t.end('500 "Execution Error!"\n'),null!=arguments[1]&&console.error(arguments[1])},hi=function(t,e){t.statusCode=422,t.setHeader("Content-Type","text/plain"),t.end(`422 ${e}\n`),null!=arguments[1]&&console.error(e)},gi=function(t,e){t.setHeader("Content-Type","application/json"),"string"==typeof e&&e.length>0?(t.statusCode=200,t.end(e)):(t.statusCode=204,t.end())},ti=Object.create(null),Fr=function(t){if("object"!=typeof t||null==t.error)return"No Error Object!"},ti["0000"]=function(t,e,n){return async function(n,r,i){var o,a;return""!==i.bodyString||""!==i.auth||""!==i.args||void 0!==i.bodyObj?si(r,`Invalid Context for handler 0000 @${t}!`):(Object.freeze(i),(a=await e(void 0,i))?"string"==typeof a&&a.length>0?(o=JSON.stringify(a),hi(r,o)):Array.isArray(a)&&1===a.length&&"string"==typeof a[0]&&a[0].length>0?(o=JSON.stringify(a[0]),hi(r,o)):Fr(a)?di(r,"Invalid result!"):(o='{"error":'+JSON.stringify(a.error)+"}",hi(r,o)):gi(r,""))}},ti[1e3]=function(t,e,n){var r,i;if("function"!=typeof(r=n.authOption))throw new Error(`authOption not a function @${t}!`);return i=async function(t,n,i){var o,a,s;return(o=await r(t,i))?ui(n,`Authentication fail! (${o})`):(Object.freeze(i.auth),i.args=void 0,Object.freeze(i),(s=await e(void 0,i))?"string"==typeof s&&s.length>0?(a=JSON.stringify(s),hi(n,a)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(a=JSON.stringify(s[0]),hi(n,a)):(o=Fr(s))?di(n,"Invalid result!"):(a='{"error":'+JSON.stringify(s.error)+"}",hi(n,a)):gi(n,""))},i},ti["0100"]=function(t,e,n){var r,i;if("function"!=typeof(i=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);return r=async function(t,n,r){var o,a,s;return(o=i(r.args))?si(n,`Validation fail! (${o})`):(Object.freeze(r),(s=await e(r.args,r))?"string"==typeof s&&s.length>0?(a=JSON.stringify(s),hi(n,a)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(a=JSON.stringify(s[0]),hi(n,a)):(o=Fr(s))?di(n,"Invalid result!"):(a='{"error":'+JSON.stringify(s.error)+"}",hi(n,a)):gi(n,""))},r},ti[1100]=function(t,e,n){var r,i,o;if("function"!=typeof(r=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(o=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);return i=async function(t,n,i){var a,s,u;return(a=await r(t,i))?ui(n,`Authentication fail! (${a})`):(Object.freeze(i.auth),(a=o(i.args))?si(n,`Validation fail! (${a})`):(Object.freeze(i),(u=await e(i.args,i))?"string"==typeof u&&u.length>0?(s=JSON.stringify(u),hi(n,s)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(s=JSON.stringify(u[0]),hi(n,s)):(a=Fr(u))?di(n,"Invalid result!"):(s='{"error":'+JSON.stringify(u.error)+"}",hi(n,s)):gi(n,"")))},i},ti["0010"]=function(t,e,n){var r;if("function"!=typeof(r=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);return async function(n,i,o){var a,s;return""!==o.bodyString||""!==o.auth||""!==o.args||void 0!==o.bodyObj?si(i,`Invalid Context for handler 0010 @${t}!`):(Object.freeze(o),s=await e(void 0,o),r(s)?"string"==typeof s&&s.length>0?(a=JSON.stringify(s),hi(i,a)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(a=JSON.stringify(s[0]),hi(i,a)):Fr(s)?di(i,"Invalid result!"):(a='{"error":'+JSON.stringify(s.error)+"}",hi(i,a)):gi(i,JSON.stringify(s)))}},ti[1010]=function(t,e,n){var r,i,o;if("function"!=typeof(r=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(o=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);return i=async function(t,n,i){var a,s,u;return(a=await r(t,i))?ui(n,`Authentication fail! (${a})`):(Object.freeze(i.auth),i.args=void 0,Object.freeze(i),u=await e(void 0,i),(a=o(u))?"string"==typeof u&&u.length>0?(s=JSON.stringify(u),hi(n,s)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(s=JSON.stringify(u[0]),hi(n,s)):(a=Fr(u))?di(n,"Invalid result!"):(s='{"error":'+JSON.stringify(u.error)+"}",hi(n,s)):gi(n,JSON.stringify(u)))},i},ti["0110"]=function(t,e,n){var r,i,o;if("function"!=typeof(i=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(o=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);return r=async function(t,n,r){var a,s,u;return(a=i(r.args))?si(n,`Validation fail! (${a})`):(Object.freeze(r),u=await e(r.args,r),(a=o(u))?"string"==typeof u&&u.length>0?(s=JSON.stringify(u),hi(n,s)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(s=JSON.stringify(u[0]),hi(n,s)):(a=Fr(u))?di(n,"Invalid result!"):(s='{"error":'+JSON.stringify(u.error)+"}",hi(n,s)):gi(n,JSON.stringify(u)))},r},ti[1110]=function(t,e,n){var r,i,o,a;if("function"!=typeof(r=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(o=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(a=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);return i=async function(t,n,i){var s,u,l;return(s=await r(t,i))?ui(n,`Authentication fail! (${s})`):(Object.freeze(i.auth),(s=o(i.args))?si(n,`Validation fail! (${s})`):(Object.freeze(i),l=await e(i.args,i),(s=a(l))?"string"==typeof l&&l.length>0?(u=JSON.stringify(l),hi(n,u)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(u=JSON.stringify(l[0]),hi(n,u)):(s=Fr(l))?di(n,"Invalid result!"):(u='{"error":'+JSON.stringify(l.error)+"}",hi(n,u)):gi(n,JSON.stringify(l))))},i},ti["0001"]=function(t,e,n){var r;if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return async function(n,i,o){var a,s,u;return""!==o.bodyString||""!==o.auth||""!==o.args||void 0!==o.bodyObj?si(i,`Invalid Context for handler 0001 @${t}!`):(Object.freeze(o),(s=await e(void 0,o))?"string"==typeof s&&s.length>0?(a='{"error":'+JSON.stringify(s)+"}",a=await r(a,o),hi(i,a)):Array.isArray(s)&&1===s.length&&"string"==typeof s[0]&&s[0].length>0?(a='{"error":'+JSON.stringify(s[0])+"}",a=await r(a,o),hi(i,a)):Fr(s)?di(i,"Invalid result!"):(a='{"error":'+JSON.stringify(s.error)+"}",a=await r(a,o),hi(i,a)):(u=await r('{"result":""}',o),gi(i,u)))}},ti[1001]=function(t,e,n){var r,i,o;if("function"!=typeof(i=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,n,o){var a,s,u,l;return(a=await i(t,o))?ui(n,`Authentication fail! (${a})`):(Object.freeze(o.auth),o.args=void 0,Object.freeze(o),(u=await e(void 0,o))?"string"==typeof u&&u.length>0?(s='{"error":'+JSON.stringify(u)+"}",s=await r(s,o),hi(n,s)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(s='{"error":'+JSON.stringify(u[0])+"}",s=await r(s,o),hi(n,s)):(a=Fr(u))?di(n,"Invalid result!"):(s='{"error":'+JSON.stringify(u.error)+"}",s=await r(s,o),hi(n,s)):(l=await r('{"result":""}',o),gi(n,l)))},o},ti["0101"]=function(t,e,n){var r,i,o;if("function"!=typeof(o=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return i=async function(t,n,i){var a,s,u,l;return(a=o(i.args))?si(n,`Validation fail! (${a})`):(Object.freeze(i),(u=await e(i.args,i))?"string"==typeof u&&u.length>0?(s='{"error":'+JSON.stringify(u)+"}",s=await r(s,i),hi(n,s)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(s='{"error":'+JSON.stringify(u[0])+"}",s=await r(s,i),hi(n,s)):(a=Fr(u))?di(n,"Invalid result!"):(s='{"error":'+JSON.stringify(u.error)+"}",s=await r(s,i),hi(n,s)):(l=await r('{"result":""}',i),gi(n,l)))},i},ti[1101]=function(t,e,n){var r,i,o,a;if("function"!=typeof(i=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,n,o){var s,u,l,f;return(s=await i(t,o))?ui(n,`Authentication fail! (${s})`):(Object.freeze(o.auth),(s=a(o.args))?si(n,`Validation fail! (${s})`):(Object.freeze(o),(l=await e(o.args,o))?"string"==typeof l&&l.length>0?(u='{"error":'+JSON.stringify(l)+"}",u=await r(u,o),hi(n,u)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(u='{"error":'+JSON.stringify(l[0])+"}",u=await r(u,o),hi(n,u)):(s=Fr(l))?di(n,"Invalid result!"):(u='{"error":'+JSON.stringify(l.error)+"}",u=await r(u,o),hi(n,u)):(f=await r('{"result":""}',o),gi(n,f))))},o},ti["0011"]=function(t,e,n){var r,i;if("function"!=typeof(i=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return async function(n,o,a){var s,u,l;return""!==a.bodyString||""!==a.auth||""!==a.args||void 0!==a.bodyObj?si(o,`Invalid Context for handler 0011 @${t}!`):(Object.freeze(a),u=await e(void 0,a),i(u)?"string"==typeof u&&u.length>0?(s='{"error":'+JSON.stringify(u)+"}",s=await r(s,a),hi(o,s)):Array.isArray(u)&&1===u.length&&"string"==typeof u[0]&&u[0].length>0?(s='{"error":'+JSON.stringify(u[0])+"}",s=await r(s,a),hi(o,s)):Fr(u)?di(o,"Invalid result!"):(s='{"error":'+JSON.stringify(u.error)+"}",s=await r(s,a),hi(o,s)):(l='{"result":'+JSON.stringify(u)+"}",l=await r(l,a),gi(o,l)))}},ti[1011]=function(t,e,n){var r,i,o,a;if("function"!=typeof(i=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,n,o){var s,u,l,f;return(s=await i(t,o))?ui(n,`Authentication fail! (${s})`):(Object.freeze(o.auth),o.args=void 0,Object.freeze(o),l=await e(void 0,o),(s=a(l))?"string"==typeof l&&l.length>0?(u='{"error":'+JSON.stringify(l)+"}",u=await r(u,o),hi(n,u)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(u='{"error":'+JSON.stringify(l[0])+"}",u=await r(u,o),hi(n,u)):(s=Fr(l))?di(n,"Invalid result!"):(u='{"error":'+JSON.stringify(l.error)+"}",u=await r(u,o),hi(n,u)):(f='{"result":'+JSON.stringify(l)+"}",f=await r(f,o),gi(n,f)))},o},ti["0111"]=function(t,e,n){var r,i,o,a;if("function"!=typeof(o=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(a=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return i=async function(t,n,i){var s,u,l,f;return(s=o(i.args))?si(n,`Validation fail! (${s})`):(Object.freeze(i),l=await e(i.args,i),(s=a(l))?"string"==typeof l&&l.length>0?(u='{"error":'+JSON.stringify(l)+"}",u=await r(u,i),hi(n,u)):Array.isArray(l)&&1===l.length&&"string"==typeof l[0]&&l[0].length>0?(u='{"error":'+JSON.stringify(l[0])+"}",u=await r(u,i),hi(n,u)):(s=Fr(l))?di(n,"Invalid result!"):(u='{"error":'+JSON.stringify(l.error)+"}",u=await r(u,i),hi(n,u)):(f='{"result":'+JSON.stringify(l)+"}",f=await r(f,i),gi(n,f)))},i},ti[1111]=function(t,e,n){var r,i,o,a,s;if("function"!=typeof(i=n.authOption))throw new Error(`authOption not a function @${t}!`);if("function"!=typeof(a=Wr(n.argsSchema,!0)))throw new Error(`validateArgs is not a function @${t}!`);if("function"!=typeof(s=Wr(n.resultSchema,!0)))throw new Error(`validateResult is not a function @${t}!`);if("function"!=typeof(r=n.responseAuth))throw new Error(`addResponseAuth is not a function @${t}!`);return o=async function(t,n,o){var u,l,f,c;return(u=await i(t,o))?ui(n,`Authentication fail! (${u})`):(Object.freeze(o.auth),(u=a(o.args))?si(n,`Validation fail! (${u})`):(Object.freeze(o),f=await e(o.args,o),(u=s(f))?"string"==typeof f&&f.length>0?(l='{"error":'+JSON.stringify(f)+"}",l=await r(l,o),hi(n,l)):Array.isArray(f)&&1===f.length&&"string"==typeof f[0]&&f[0].length>0?(l='{"error":'+JSON.stringify(f[0])+"}",l=await r(l,o),hi(n,l)):(u=Fr(f))?di(n,"Invalid result!"):(l='{"error":'+JSON.stringify(f.error)+"}",l=await r(l,o),hi(n,l)):(c='{"result":'+JSON.stringify(f)+"}",c=await r(c,o),gi(n,c))))},o};var Si,Oi,Ai,Ei,$i,Ci,Ti=function(t,e,n){if(null!==vi)throw new Error("Server already running!");if("string"!=typeof t)throw new Error("Route not a string!");if("function"!=typeof e)throw new Error("Func not a function!");if(null!=pi[t])throw new Error("Cannot add route twice!");if(null==e)throw new Error("function must be defined!");null!=n&&"object"==typeof n||(n=Object.create(null)),pi[t]={func:e,conf:n}},Di=function(t){if(null!==vi)throw new Error("Server already running!");if("function"!=typeof t)throw new Error("Func not a function!");Wr=t},ki=async function(t){var e,n,r,i,o,a,s,u,l,f,c;for(ni("sciStartServer"),null!=t&&"object"==typeof t||(t=Object.create(null)),Qr=t.bodySizeLimit||5e5,f=t.requestTimeout||5e4,n=t.headersTimeout||8e3,o=t.keepAliveTimeout||12e4,t.maxHeadersCount,u=t.maxHeaderSize||2048,i=0,a=(c=Zr(pi)).length;i<a;i++)l=c[i],yi[l[0]]=l[1];pi=null,r={headersTimeout:n,maxHeaderSize:u,requestTimeout:f,keepAliveTimeout:o},(vi=bi().createServer(r)).on("request",ri),vi.on("upgrade",Yr),vi.on("clientError",Vr),"number"==typeof t.backlog&&(e=t.backlog),s={backlog:e,listenOn:t.listenOn||3333},await mi(s),ii({listeningMode:ei}),process.on("SIGTERM",wi),process.on("SIGINT",wi)};({log:Si,olog:Oi}=S("accesssci")),Di(re),Ti("grantAccess",A,{bodySizeLimit:1024,authOption:ye,argsSchema:{authCode:8,ttlMS:2}}),Ti("revokeAccess",E,{bodySizeLimit:1024,authOption:ye,argsSchema:8}),({log:Ai,olog:Ei}=S("datasci")),Di(re),Ti("getEODHLCData",async function(t){return await qr(t.dataKey,t.yearsBack)},{bodySizeLimit:1024,authOption:function(t){return null!=t&&$(t.authCode)},argsSchema:{authCode:8,dataKey:14,yearsBack:30},resultSchema:{meta:{startDate:14,endDate:14,interval:"1d",historyComplete:1},data:3}}),({log:$i,olog:Ci}=S("scimodule"));var xi,Ni,ji=async function(){$i("prepareAndExpose"),await ki(),$i("Server listening!")};({log:xi,olog:Ni}=S("startupmodule"));var Ii,zi,Ji,_i,Ri,Ui,Pi,Mi,Hi,Bi,qi,Li=async function(){xi("serviceStartup"),Bn(),await ki()};({log:_i,olog:Ri}=S("tradovatemodule")),qi=null,Bi=null;var Fi=function(t){_i("initialize")};Hi=function(t){_i("saveStorage"),t&&(Bi=t),br("datahubState",Bi)},Ji=async function(t,e){var n,r,i,o;_i("getRequest"),r={method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},null!=e&&(r.headers.Authorization=`Bearer ${e}`);try{i=await fetch(t,r)}catch(t){n=t,console.error(n)}try{if(i.ok)return await i.json();console.error("status: "+i.status),o=await i.text(),console.error(o)}catch(t){n=t,console.error(n)}},Ui=async function(t,e,n){var r,i,o,a;_i("postRequest"),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},null!=n&&(i.headers.Authorization=`Bearer ${n}`);try{o=await fetch(t,i)}catch(t){r=t,console.error(r)}try{if(o.ok)return await o.json();console.error("status: "+o.status),a=await o.text(),console.error(a)}catch(t){r=t,console.error(r)}},Pi=async function(){var t,e;_i("refreshToken"),e=qi+"/auth/renewAccessToken",t=await Ji(e,Bi.accessToken),Ri(t),null!=t.accessToken&&(Bi.accessToken=t.accessToken),null!=t.mdAccessToken&&(Bi.mdAccessToken=t.mdAccessToken),null!=t.expirationTime&&(Bi.expirationTime=t.expirationTime),Hi()},Mi=async function(){var t,e,n;_i("requestAccessToken"),e={name:null,password:null,appId:"sentinel",appVersion:null,cid:null,sec:null},n=qi+"/auth/accesstokenrequest",t=await Ui(n,e),Ri(t),null!=t&&Hi(t)},zi=function(){var t,e,n,r;return _i("ensureFreshToken"),null==(e=Bi.expirationTime)?Mi():(t=new Date(e).getTime(),n=(new Date).getTime(),Ri({exp:t,now:n,timeToExpiry:r=t-n}),r<0?Mi():r<114e4?Pi():void 0)},Ii=async function(){var t,e;_i("checkSymbols"),_i("using url: "+(e=qi+"/product/list")),t=await Ji(e,Bi.mdAccessToken),Ri(t)};var Vi,Gi,Zi,Yi,Wi,Ki,Qi=async function(t){_i("startSession"),t&&await Mi(),await zi(),setInterval(zi,6e5),await Ii(),setInterval(Ii,36e5)};({log:Yi,olog:Wi}=S("wsimodule")),Gi=0,Vi=class{constructor(t,e){var n;this.onMessage=this.onMessage.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.noteUsage=this.noteUsage.bind(this),this.close=this.close.bind(this),this.socket=t,this.clientId=e,n=this,this.socket.onmessage=function(t){return n.onMessage(t)},this.socket.onclose=function(t){return n.onDisconnect(t)},Yi(`${this.clientId} connected!`)}onMessage(t){var e,n,r,i;Yi("onMessage"),e=performance.now();try{r=Ki(t.data,this.socket)}catch(t){Ne("Socket.onMessage: "+t.message)}n=performance.now()-e,(i=null!=r?r:{success:!1,error:"fatal",bytes:t.data.length}).processingTime=n,this.noteUsage(i)}onDisconnect(t){Yi(`onDisconnect: ${this.clientId}`);try{Rn(this.socket)}catch(t){Yi(t)}}noteUsage(t){Yi(`noteUsage: ${this.clientId}`),Wi(t)}close(){Yi(`closeSocket for: ${this.clientId}`),this.socket.close()}},Zi=function(t){var e,n,r,i;return Yi("disectMessage"),r=(i=t.split(" "))[0],n="",e="",i.length>=2&&(n=i[1]),3===i.length&&(e=i[2]),i.length>3&&(e=i.slice(2).join(" ")),{command:r,authCode:n,argument:e}},Ki=function(t,e){var n,r;return Yi("processMessage"),Wi({message:t}),(r=Object.create(null)).success=!1,r.bytes=t.length,n=Zi(t),Wi(n),r.error="Unauthorized!",$(n.authCode)?(r.error=`unknown command: ${n.command}`,"subscribe"!==n.command||(_n(e,n.argument),r.success=!0,r.error=null),r):r};var Xi=function(t,e){Wi(e.body),new Vi(t,`${Gi}`),Gi++};const to={accessmodule:e,authmodule:r,configmodule:i,datamodule:f,dateutilsmodule:o,debugmodule:c,earlyblockermodule:n,livefeedmodule:a,marketstackmodule:s,scimodule:d,startupmodule:h,storagemodule:u,symbolsmodule:l,tradovatemodule:g,wsimodule:v};global.allModules=to,async function(){var t,e,n;try{return n=function(){var n;for(e in n=[],to)null!=(t=to[e]).initialize&&n.push(t.initialize(i));return n}(),await Promise.all(n),await to.startupmodule.serviceStartup()}catch(t){return Ne("@run: "+t.message)}}()})();